








<!doctype html>
<html 
      lang="en"
      dir="ltr">
  <head>
    <meta name="google-signin-client-id" content="721724668570-nbkv1cfusk7kk4eni4pjvepaus73b13t.apps.googleusercontent.com">
    <meta name="google-signin-scope"
          content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="Google Codelabs">
    <meta property="og:type" content="website"><meta name="theme-color" content="#1a73e8"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <link rel="manifest" href="/_pwa/codelabs/manifest.json"
          crossorigin="use-credentials">
    <link rel="preconnect" href="//www.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="//apis.google.com" crossorigin>
    <link rel="preconnect" href="//www.google-analytics.com" crossorigin><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap">
      <link rel="stylesheet"
            href="//fonts.googleapis.com/css2?family=Material+Icons&family=Material+Symbols+Outlined&display=block"><link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/css/app.css">
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/touchicon-180.png"><link rel="canonical" href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions"><link rel="search" type="application/opensearchdescription+xml"
            title="Google Codelabs" href="https://codelabs.developers.google.com/s/opensearch.xml">
      <link rel="alternate" hreflang="en"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions" /><link rel="alternate" hreflang="x-default" href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions" /><link rel="alternate" hreflang="ar"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=ar" /><link rel="alternate" hreflang="bn"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=bn" /><link rel="alternate" hreflang="zh-Hans"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=zh-cn" /><link rel="alternate" hreflang="zh-Hant"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=zh-tw" /><link rel="alternate" hreflang="fa"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=fa" /><link rel="alternate" hreflang="fr"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=fr" /><link rel="alternate" hreflang="de"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=de" /><link rel="alternate" hreflang="he"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=he" /><link rel="alternate" hreflang="hi"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=hi" /><link rel="alternate" hreflang="id"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=id" /><link rel="alternate" hreflang="it"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=it" /><link rel="alternate" hreflang="ja"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=ja" /><link rel="alternate" hreflang="ko"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=ko" /><link rel="alternate" hreflang="pl"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=pl" /><link rel="alternate" hreflang="pt-BR"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=pt-br" /><link rel="alternate" hreflang="ru"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=ru" /><link rel="alternate" hreflang="es-419"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=es-419" /><link rel="alternate" hreflang="th"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=th" /><link rel="alternate" hreflang="tr"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=tr" /><link rel="alternate" hreflang="vi"
          href="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions?hl=vi" /><title>Google&#39;s Agent Stack in Action: ADK, A2A, MCP on Google Cloud &nbsp;|&nbsp; Google Codelabs</title>

<meta property="og:title" content="Google&#39;s Agent Stack in Action: ADK, A2A, MCP on Google Cloud &nbsp;|&nbsp; Google Codelabs"><meta name="description" content="Master multi-agent AI development with Google‚Äôs Agent Development Kit (ADK). This hands-on workshop guides you through building, orchestrating, and connecting collaborative agents using ADK, A2A (Agent-to-Agent) communication, and the Model Context Protocol (MCP). You‚Äôll apply these skills by developing ‚ÄúInstaVibe,‚Äù an AI-powered social event planning assistant, and learn to deploy your multi-agent system on Google Cloud.">
  <meta property="og:description" content="Master multi-agent AI development with Google‚Äôs Agent Development Kit (ADK). This hands-on workshop guides you through building, orchestrating, and connecting collaborative agents using ADK, A2A (Agent-to-Agent) communication, and the Model Context Protocol (MCP). You‚Äôll apply these skills by developing ‚ÄúInstaVibe,‚Äù an AI-powered social event planning assistant, and learn to deploy your multi-agent system on Google Cloud."><meta property="og:url" content="https://codelabs.developers.google.com/instavibe-adk-multi-agents/instructions"><meta property="og:locale" content="en">
  
    
    
    
    
    
    
    
    
    
    
  

    
      <link rel="stylesheet" href="/extras.css"></head>
  <body class=""
        template="codelab"
        theme="codelabs-theme"
        type="codelab"
        
        
        
        
        layout="docs"
        
        
        
        
        display-toc
        pending>
  
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
  
  
    <a href="#main-content" class="skip-link button">
      
      Skip to main content
    </a>
    <section class="devsite-wrapper">
      <devsite-cookie-notification-bar></devsite-cookie-notification-bar><devsite-header role="banner">
  
    





















<div class="devsite-header--inner" data-nosnippet>
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Open menu">
        </button>
        
<div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="googleCodelabs" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/lockup.svg" class="devsite-site-logo" alt="Google Codelabs">
  </picture>
  
</a>



</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
           </div>
          
<devsite-search
    enable-signin
    enable-search
    enable-suggestions
      enable-query-completion
    
    enable-search-summaries
    
    tenant-name="Google Codelabs"
    
    
    
    
    
    >
  <form class="devsite-search-form" action="https://codelabs.developers.google.com/s/results" method="GET">
    <div class="devsite-search-container">
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              
              aria-label="Open search"></button>
      <div class="devsite-searchbox">
        <input
          aria-activedescendant=""
          aria-autocomplete="list"
          
          aria-label="Search"
          aria-expanded="false"
          aria-haspopup="listbox"
          autocomplete="off"
          class="devsite-search-field devsite-search-query"
          name="q"
          
          placeholder="Search"
          role="combobox"
          type="text"
          value=""
          >
          <div class="devsite-search-image material-icons" aria-hidden="true">
            
              <svg class="devsite-search-ai-image" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_6641_386)">
                    <path d="M19.6 21L13.3 14.7C12.8 15.1 12.225 15.4167 11.575 15.65C10.925 15.8833 10.2333 16 9.5 16C7.68333 16 6.14167 15.375 4.875 14.125C3.625 12.8583 3 11.3167 3 9.5C3 7.68333 3.625 6.15 4.875 4.9C6.14167 3.63333 7.68333 3 9.5 3C10.0167 3 10.5167 3.05833 11 3.175C11.4833 3.275 11.9417 3.43333 12.375 3.65L10.825 5.2C10.6083 5.13333 10.3917 5.08333 10.175 5.05C9.95833 5.01667 9.73333 5 9.5 5C8.25 5 7.18333 5.44167 6.3 6.325C5.43333 7.19167 5 8.25 5 9.5C5 10.75 5.43333 11.8167 6.3 12.7C7.18333 13.5667 8.25 14 9.5 14C10.6667 14 11.6667 13.625 12.5 12.875C13.35 12.1083 13.8417 11.15 13.975 10H15.975C15.925 10.6333 15.7833 11.2333 15.55 11.8C15.3333 12.3667 15.05 12.8667 14.7 13.3L21 19.6L19.6 21ZM17.5 12C17.5 10.4667 16.9667 9.16667 15.9 8.1C14.8333 7.03333 13.5333 6.5 12 6.5C13.5333 6.5 14.8333 5.96667 15.9 4.9C16.9667 3.83333 17.5 2.53333 17.5 0.999999C17.5 2.53333 18.0333 3.83333 19.1 4.9C20.1667 5.96667 21.4667 6.5 23 6.5C21.4667 6.5 20.1667 7.03333 19.1 8.1C18.0333 9.16667 17.5 10.4667 17.5 12Z" fill="#5F6368"/>
                  </g>
                <defs>
                <clipPath id="clip0_6641_386">
                <rect width="24" height="24" fill="white"/>
                </clipPath>
                </defs>
              </svg>
            
          </div>
          <div class="devsite-search-shortcut-icon-container" aria-hidden="true">
            <kbd class="devsite-search-shortcut-icon">/</kbd>
          </div>
      </div>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          
          aria-label="Close search"></button>
</devsite-search>

        </div>

        

          

          

          

          
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="de"
        >Deutsch</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es"
        >Espa√±ol</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Espa√±ol ‚Äì Am√©rica Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Fran√ßais</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="it"
        >Italiano</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Portugu√™s ‚Äì Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Ti√™ÃÅng Vi√™Ã£t</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="tr"
        >T√ºrk√ße</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ru"
        >–†—É—Å—Å–∫–∏–π</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="he"
        >◊¢◊ë◊®◊ô◊™</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ar"
        >ÿßŸÑÿπÿ±ÿ®ŸäŸëÿ©</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fa"
        >ŸÅÿßÿ±ÿ≥€å</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="hi"
        >‡§π‡§ø‡§Ç‡§¶‡•Ä</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="bn"
        >‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="th"
        >‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >‰∏≠Êñá ‚Äì ÁÆÄ‰Ωì</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_tw"
        >‰∏≠Êñá ‚Äì ÁπÅÈ´î</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >Êó•Êú¨Ë™û</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >ÌïúÍµ≠Ïñ¥</a>
    </li>
    
  </ul>
</devsite-language-selector>


          

        

        
          <devsite-user 
                        
                        
                          enable-profiles
                        
                        
                          fp-auth
                        
                        id="devsite-user">
            
              
              <span class="button devsite-top-button" aria-hidden="true" visually-hidden>Sign in</span>
            
          </devsite-user>
        
        
        
      </div>
    </div>
  </div>



</div>



  
</devsite-header>
      <devsite-book-nav scrollbars hidden>
        
          





















<div class="devsite-book-nav-filter"
     hidden>
  <span class="filter-list-icon material-icons" aria-hidden="true"></span>
  <input type="text"
         placeholder="Filter"
         
         aria-label="Type to filter"
         role="searchbox">
  
  <span class="filter-clear-button hidden"
        data-title="Clear filter"
        aria-label="Clear filter"
        role="button"
        tabindex="0"></span>
</div>

<nav class="devsite-book-nav devsite-nav nocontent"
     aria-label="Side menu">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="googleCodelabs" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/lockup.svg" class="devsite-site-logo" alt="Google Codelabs">
  </picture>
  
</a>


</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
          
          
        </ul>
      
    </div>
    
  </div>
</nav>
        
      </devsite-book-nav>
      <section id="gc-wrapper">
        <main role="main" id="main-content" class="devsite-main-content"
            
              
              has-sidebar
            >
          <div class="devsite-sidebar">
            <div class="devsite-sidebar-content">
                
                <devsite-toc class="devsite-nav"
                            role="navigation"
                            aria-label="On this page"
                            depth="1"
                            scrollbars
                  ></devsite-toc>
                <devsite-recommendations-sidebar class="nocontent devsite-nav">
                </devsite-recommendations-sidebar>
            </div>
          </div>
          <devsite-content>
            
              












<article class="devsite-article"><style>
      body {
        transition: opacity ease-in 0.2s;
      }

      body[unresolved] {
        opacity: 0;
        display: block;
        overflow: hidden;
        position: relative;
      }
      </style>
  
  
  
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list"
  >
  
</ul>
    
  </div>
  
    <h1 class="devsite-page-title" tabindex="-1">
      Google&#39;s Agent Stack in Action: ADK, A2A, MCP on Google Cloud<div class="devsite-actions" hidden data-nosnippet></div>
  
      
    </h1>
  

  <devsite-toc class="devsite-nav"
    depth="1"
    devsite-toc-embedded
    >
  </devsite-toc>
  
    
  <div class="devsite-article-body clearfix
  ">

  
    
    
    <google-codelab-analytics gaid="UA-49880327-14" ga4id="G-JTFZSJVVVZ"></google-codelab-analytics>
    <google-codelab codelab-gaid=""
                    codelab-ga4id=""
                    doc-id=""
                    id="instavibe-adk-multi-agent"
                    title="Google&#39;s Agent Stack in Action: ADK, A2A, MCP on Google Cloud"
                    no-tooltip=""
                    environment="web"
                    category=""
                    feedback-link=""
                    layout="paginated"
                    >
      
        <google-codelab-step label="What you will learn" duration="0" step="0">
          
            <google-codelab-about codelab-title="Google&#39;s Agent Stack in Action: ADK, A2A, MCP on Google Cloud"
                                  authors="Christina Lin"
                                  last-updated="2025-08-14T21:27:52Z"
                                  >
            </google-codelab-about>
          
          <h2 class="step-title" id="0" data-text="What you will learn" tabindex="-1">
              1. What you will learn
          </h2>
          <p>Welcome! We&#39;re about to embark on a pretty cool journey today. Let&#39;s start by thinking about a popular social event platform InstaVibe. While it&#39;s successful, we know that for some users, the actual planning of group activities can feel like a chore. Imagine trying to figure out what all your friends are interested in, then sifting through endless options for events or venues, and finally coordinating everything. It&#39;s a lot! This is precisely where we can introduce AI, and more specifically, intelligent agents, to make a real difference.</p>
<p>The idea is to build a system where these agents can handle the heavy lifting, like cleverly ‚Äòlistening&#39; to understand user and friend preferences, and then proactively suggesting fantastic, tailored activities. Our aim is to transform social planning on InstaVibe into something seamless and delightful. To get started on building these smart assistants, we need to lay a strong groundwork with the right tools.</p>
<p>Here&#39;s the concept you&#39;ll see:</p>
<p class="image-container"><img alt="Title Page " src="/static/instavibe-adk-multi-agents/img/01-01-title.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/01-01-title_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p><strong>Foundations with Google&#39;s ADK:</strong> Master the fundamentals of building your first intelligent agent using Google&#39;s Agent Development Kit (ADK). Understand the essential components, the agent lifecycle, and how to leverage the framework&#39;s built-in tools effectively.</p>
<p><strong>Extending Agent Capabilities with Model Context Protocol (MCP):</strong> Learn to equip your agents with custom tools and context, enabling them to perform specialized tasks and access specific information. Introduce the Model Context Protocol (MCP) concept. You&#39;ll learn how to set up an MCP server to provide this context.</p>
<p><strong>Designing Agent Interactions &amp; Orchestration:</strong> Move beyond single agents to understand agent orchestration. Design interaction patterns ranging from simple sequential workflows to complex scenarios involving loops, conditional logic, and parallel processing. Introduce the concept of sub-agents within the ADK framework to manage modular tasks.</p>
<p><strong>Building Collaborative Multi-Agent Systems:</strong> Discover how to architect systems where multiple agents collaborate to achieve complex goals. Learn and implement the Agent-to-Agent (A2A) communication protocol, establishing a standardized way for distributed agents (potentially running on different machines or services) to interact reliably.</p>
<p><strong>Productionizing Agents on Google Cloud:</strong> Transition your agent applications from development environments to the cloud. Learn best practices for architecting and deploying scalable, robust multi-agent systems on Google Cloud Platform (GCP). Gain insights into leveraging GCP services like Cloud Run and explore the capabilities of the latest Google Agent Engine for hosting and managing your agents.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Architecture" duration="0" step="1">
          
          <h2 class="step-title" id="1" data-text="Architecture" tabindex="-1">
              2. Architecture
          </h2>
          <h2 is-upgraded id="ai-powered-social-planning-with-instavibe" data-text="AI-Powered Social Planning with InstaVibe" tabindex="-1">AI-Powered Social Planning with InstaVibe</h2>
<p><strong>What is Social Listening?</strong></p>
<p>Social listening is the process of monitoring digital conversations across platforms like social media, forums, and news sites to understand what people are saying about a topic, brand, or industry. It provides valuable insights into public sentiment, trends, and user needs. In this workshop, we&#39;ll leverage this concept within an agent-based system.</p>
<p><strong>You&#39;re on the Team at InstaVibe</strong></p>
<p>Imagine you work at &#34;InstaVibe,&#34; a successful startup with a popular social event platform targeted at young adults. Things are going well, but like many tech companies, your team faces pressure from investors to innovate using AI. Internally, you&#39;ve also noticed a segment of users who aren&#39;t engaging as much as others ‚Äì maybe they&#39;re less inclined to initiate group activities or find the planning process challenging. For your company, this means lower platform stickiness among this important user group.</p>
<p>Your team&#39;s research suggests that AI-driven assistance could significantly improve the experience for these users. The idea is to streamline the process of planning social outings by proactively suggesting relevant activities based on the interests of the user and their friends. The question you and your colleagues face is: How can AI agents automate the often time-consuming tasks of interest discovery, activity research, and potentially initial coordination?</p>
<p><strong>An Agent-Based Solution (Prototype Concept)</strong></p>
<p>You propose developing a prototype feature powered by a multi-agent system. Here&#39;s a conceptual breakdown:</p>
<p class="image-container"><img alt="Usecase" src="/static/instavibe-adk-multi-agents/img/02-02-usecase.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-02-usecase_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<ul>
<li><strong>Social profiling Agent</strong>: This agent employs social listening techniques to analyze user connections, interactions and potentially broader public trends related to the user&#39;s preferences. Its purpose is to identify shared interests and suitable activity characteristics (e.g., preferences for quieter gatherings, specific hobbies).</li>
<li><strong>Event Planning Agent</strong>: Using the insights from the Social profiling Agent, this agent searches online resources for specific events, venues, or ideas that align with the identified criteria (such as location, interests).</li>
<li><strong>Platform Interaction Agent (using MCP)</strong>: This agent takes the finalized plan from the Activity Planning Agent. Its key function is to interact directly with the InstaVibe platform by utilizing a pre-defined MCP (Model Context Protocol) tool. This tool provides the agent with the specific capability to draft an event suggestion and create a post outlining the plan.</li>
<li><strong>Orchestrator Agent</strong>: This agent acts as the central coordinator. It receives the initial user request from the InstaVibe platform, understands the overall goal (e.g., &#34;plan a event for me and my friends&#34;), and then delegates specific tasks to the appropriate specialized agents in a logical sequence. It manages the flow of information between agents and ensures the final result is delivered back to the user.</li>
</ul>
<h2 is-upgraded id="key-architectural-elements-and-technologies" data-text="Key Architectural Elements and Technologies" tabindex="-1">Key Architectural Elements and Technologies</h2>
<p class="image-container"><img alt="Architecture" src="/static/instavibe-adk-multi-agents/img/02-01-architecture.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-01-architecture_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Google Cloud Platform (GCP):</p>
<ul>
<li><strong>Vertex AI</strong>: <ul>
<li>Gemini Models: Provides access to Google&#39;s state-of-the-art Large Language Models (LLMs) like Gemini, which power the reasoning and decision-making capabilities of our agents.</li>
<li>Vertex AI Agent Engine: A managed service used to deploy, host, and scale our orchestrator agent, simplifying productionization and abstracting infrastructure complexities.</li>
</ul>
</li>
<li><strong>Cloud Run</strong>: A serverless platform for deploying containerized applications. We use it to: <ul>
<li>Host the main InstaVibe web application.</li>
<li>Deploy individual A2A-enabled agents (Planner, Social Profiling, Platform Interaction) as independent microservices.</li>
<li>Run the MCP Tool Server, making InstaVibe&#39;s internal APIs available to agents.</li>
</ul>
</li>
<li><strong>Spanner</strong>: A fully managed, globally distributed, and strongly consistent relational database. In this workshop, we leverage its capabilities as a Graph Database using its GRAPH DDL and query features to: <ul>
<li>Model and store complex social relationships (users, friendships, event attendance, posts).</li>
<li>Enable efficient querying of these relationships for the Social Profiling agents.</li>
</ul>
</li>
<li><strong>Artifact Registry</strong>: A fully managed service for storing, managing, and securing container images.</li>
<li><strong>Cloud Build</strong>: A service that executes your builds on Google Cloud. We use it to automatically build Docker container images from our agent and application source code.</li>
<li><strong>Cloud Storage</strong>: Used by services like Cloud Build for storing build artifacts and by Agent Engine for its operational needs.</li>
<li><strong>Core Agent Frameworks &amp; Protocols</strong>: <ul>
<li><strong>Google&#39;s Agent Development Kit (ADK)</strong>: The primary framework for: <ul>
<li>Defining the core logic, behavior, and instruction sets for individual intelligent agents.</li>
<li>Managing agent lifecycles, state, and memory (short-term session state and potentially long-term knowledge).</li>
<li>Integrating tools (like Google Search or custom-built tools) that agents can use to interact with the world.</li>
<li>Orchestrating multi-agent workflows, including sequential, loop, and parallel execution of sub-agents.</li>
</ul>
</li>
<li><strong>Agent-to-Agent (A2A) Communication Protocol</strong>: An open standard enabling: <ul>
<li>Direct, standardized communication and collaboration between different AI agents, even if they are running as separate services or on different machines.</li>
<li>Agents to discover each other&#39;s capabilities (via Agent Cards) and delegate tasks. This is crucial for our Orchestrator agent to interact with the specialized Planner, Social, and Platform agents.</li>
</ul>
</li>
<li><strong>A2A Python Library (a2a-python)</strong>: The concrete library used to make our ADK agents speak the A2A protocol. It provides the server-side components needed to: <ul>
<li>Expose our agents as A2A-compliant servers.</li>
<li>Automatically handle serving the &#34;Agent Card&#34; for discovery.</li>
<li>Receive and manage incoming task requests from other agents (like the Orchestrator).</li>
</ul>
</li>
<li><strong>Model Context Protocol (MCP)</strong>: An open standard that allows agents to: <ul>
<li>Connect with and utilize external tools, data sources, and systems in a standardized way.</li>
<li>Our Platform Interaction Agent uses an MCP client to communicate with an MCP server, which in turn exposes tools to interact with the InstaVibe platform&#39;s existing APIs.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Debugging Tools</strong>: <ul>
<li><strong>A2A Inspector</strong>: The A2A Inspector is a web-based debugging tool used throughout this workshop to connect to, inspect, and interact with our A2A-enabled agents. While not part of the final production architecture, it is an essential part of our development workflow. It provides: <ul>
<li>Agent Card Viewer: To fetch and validate an agent&#39;s public capabilities.</li>
<li>Live Chat Interface: To send messages directly to a deployed agent for immediate testing.</li>
<li>Debug Console: To view the raw JSON-RPC messages being exchanged between the inspector and the agent.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Language Models (LLMs)</strong>: The &#34;Brains&#34; of the System: <ul>
<li>Google&#39;s Gemini Models: Specifically, we utilize versions like <em>gemini-2.0-flash</em>. These models are chosen for: <ul>
<li>Advanced Reasoning &amp; Instruction Following: Their ability to understand complex prompts, follow detailed instructions, and reason about tasks makes them suitable for powering agent decision-making.</li>
<li>Tool Use (Function Calling): Gemini models excel at determining when and how to use the tools provided via ADK, enabling agents to gather information or perform actions.</li>
<li>Efficiency (Flash Models): The &#34;flash&#34; variants offer a good balance of performance and cost-effectiveness, suitable for many interactive agent tasks that require quick responses.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 is-upgraded id="need-google-cloud-credits" data-text="Need Google Cloud Credits?" tabindex="-1">Need Google Cloud Credits?</h2>
<aside class="special"><p> ‚Ä¢ <strong>If you are attending an instructor-led workshop</strong>: Your instructor will provide you with a credit code. Please use the one they provide. <br> ‚Ä¢ <strong>If you are working through this Codelab on your own</strong>: You can redeem a free Google Cloud credit to cover the workshop costs. Please <a href="https://goo.gle/instavibe-codelab-credits" target="_blank">click this link</a> to get a credit and follow the steps in the video guide below to apply it to your account. <br><a href="https://youtu.be/dR-NrgMTADs" target="_blank"><img alt="Watch the video" src="/static/instavibe-adk-multi-agents/img/02-03-video.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/02-03-video_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></a><br></p>
</aside>


        </google-codelab-step>
      
        <google-codelab-step label="Before you begin" duration="0" step="2">
          
          <h2 class="step-title" id="2" data-text="Before you begin" tabindex="-1">
              3. Before you begin
          </h2>
          <p>üëâClick <strong>Activate Cloud Shell</strong> at the top of the Google Cloud console (It&#39;s the terminal shape icon at the top of the Cloud Shell pane), <img alt="Cloud Shell" src="/static/instavibe-adk-multi-agents/img/03-01-cloud-shell.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-01-cloud-shell_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâClick on the &#34;Open <strong>Editor</strong>&#34; button (it looks like an open folder with a pencil). This will open the Cloud Shell Code Editor in the window. You&#39;ll see a file explorer on the left side. <img alt="Cloud Shell" src="/static/instavibe-adk-multi-agents/img/03-04-open-editor.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-04-open-editor_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâClick on the <strong>Cloud Code Sign-in</strong> button in the bottom status bar as shown. Authorize the plugin as instructed. If you see <strong>Cloud Code - no project</strong> in the status bar, select that then in the drop down ‚ÄòSelect a Google Cloud Project&#39; and then select the specific Google Cloud Project from the list of projects that you created. <img alt="Cloud Shell" src="/static/instavibe-adk-multi-agents/img/03-02-login-project.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-02-login-project_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Find your <em>Google Cloud Project ID</em>:</p>
<ul>
<li>Open the Google Cloud Console:  https://console.cloud.google.com</li>
<li>Select the project you want to use for this workshop from the project dropdown at the top of the page.</li>
<li>Your Project ID is displayed in the Project info card on the Dashboard</li>
</ul>
<p class="image-container"><img alt="Cloud Shell" src="/static/instavibe-adk-multi-agents/img/03-10-project-id.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-10-project-id_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâOpen the terminal in the cloud IDE, <img alt="Cloud Shell" src="/static/instavibe-adk-multi-agents/img/03-03-new-terminal.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-03-new-terminal_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<aside class="special"><p><strong>A Quick Guide to Code Snippets <br></strong>To make it clear where each piece of code belongs, we&#39;ll use emojis as a guide throughout this workshop: <br><br> ‚óè üëâ <em>Action Step</em>: When you see the pointing finger, it marks the beginning of an instruction you need to follow. <br> ‚óè üëÄ <em>Observe / FYI</em>: When you see the eyes, it means you should observe the information provided, such as expected terminal output, a log snippet, or a JSON structure for reference. <strong>Do not copy or run this content</strong>. <br> ‚óè üìù <em>In the Editor</em>: When you see this emoji, it means the code block should be copied and pasted into the specified file within the Editor. <br> ‚óè üíª <em>In the Terminal</em>: When you see this emoji, it means the command should be run in the Terminal.<br><br><img alt="Newbie guide" src="/static/instavibe-adk-multi-agents/img/03-11-for-newbir.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-11-for-newbir_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
</aside>
<p>üëâüíª In the terminal, verify that you&#39;re already authenticated and that the project is set to your project ID using the following command:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">auth</span> <span class="devsite-syntax-nb">list</span>
</code></pre></devsite-code>
<p>üëâüíª Clone the <code translate="no" dir="ltr">instavibe-bootstrap</code> project from GitHub:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">git</span> <span class="devsite-syntax-n">clone</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">b</span> <span class="devsite-syntax-n">adk</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mf">1.2.1</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">a2a</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mf">0.2.7</span> <span class="devsite-syntax-n">https</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-n">github</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">weimeilin79</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">git</span>
<span class="devsite-syntax-n">chmod</span> <span class="devsite-syntax-o">+</span><span class="devsite-syntax-n">x</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">init</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">chmod</span> <span class="devsite-syntax-o">+</span><span class="devsite-syntax-n">x</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
</code></pre></devsite-code>
<h2 is-upgraded id="understanding-the-project-structure" data-text="Understanding the Project Structure" tabindex="-1">Understanding the Project Structure</h2>
<p>Before we start building, let&#39;s take a moment to understand the layout of the <code translate="no" dir="ltr">instavibe-bootstrap</code> project you just cloned. This will help you know where to find and edit files throughout the workshop.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">orchestrate</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">platform_mcp_client</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îî‚îÄ‚îÄ</span> <span class="devsite-syntax-n">social</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">static</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îî‚îÄ‚îÄ</span> <span class="devsite-syntax-n">templates</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îÇ</span>   <span class="devsite-syntax-err">‚îî‚îÄ‚îÄ</span> <span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">utils</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-err">‚îú‚îÄ‚îÄ</span> <span class="devsite-syntax-n">init</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-err">‚îî‚îÄ‚îÄ</span> <span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
</code></pre></devsite-code>
<p>Here is a breakdown of the key directories:</p>
<ul>
<li><code translate="no" dir="ltr">agents/</code>: This is the heart of our AI system. Each subdirectory (planner/, social/, etc.) contains the source code for a specific intelligent agent. <ul>
<li><code translate="no" dir="ltr">agent.py</code>: Inside each agent&#39;s folder, this is the main file where the agent&#39;s logic.</li>
<li><code translate="no" dir="ltr">a2a_server.py</code>: This file wraps the ADK agent with an Agent-to-Agent (A2A) server.</li>
<li><code translate="no" dir="ltr">Dockerfile</code>: Defines how to build the container image for deploying the agent to Cloud Run or Agent Engine.</li>
</ul>
</li>
<li><code translate="no" dir="ltr">instavibe/</code>: This directory contains the entire source code for the InstaVibe web application.</li>
<li><code translate="no" dir="ltr">tools/</code>: This directory is for building external tools that our agents can use. <ul>
<li><code translate="no" dir="ltr">instavibe/</code> contains the Model Context Protocol (MCP) Server.</li>
</ul>
</li>
</ul>
<p>This modular structure separates the web application from the various AI components, making the entire system easier to manage, test, and deploy.</p>
<p>üëâüíª Run the initialization script:</p>
<p>This script will prompt you to enter your <em>Google Cloud Project ID</em>.</p>
<p>Enter <em>Google Cloud Project ID</em> you found from the last step when prompted by the <code translate="no" dir="ltr">init.sh</code> script:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span>
<span class="devsite-syntax-o">./</span><span class="devsite-syntax-n">init</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
</code></pre></devsite-code>
<p>üëâüíª Set the Project ID needed:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">config</span> <span class="devsite-syntax-nb">set</span> <span class="devsite-syntax-n">project</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">cat</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">project_id</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>
</code></pre></devsite-code>
<p>üëâüíª Run the following command to enable the necessary Google Cloud APIs:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">enable</span>  <span class="devsite-syntax-n">run</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">cloudfunctions</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">cloudbuild</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">artifactregistry</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">spanner</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">apikeys</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">compute</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">aiplatform</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">cloudresourcemanager</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span> \
                        <span class="devsite-syntax-n">maps</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">backend</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">googleapis</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span>
</code></pre></devsite-code>
<p>üëâüíª Set all the environment variable needed:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">config</span> <span class="devsite-syntax-n">get</span> <span class="devsite-syntax-n">project</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PROJECT_NUMBER</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">describe</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"value(projectNumber)"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_ACCOUNT_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">compute</span> <span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">info</span> <span class="devsite-syntax-n">describe</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"value(defaultServiceAccount)"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SPANNER_INSTANCE_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe-graph-instance"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SPANNER_DATABASE_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"graphdb"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">GOOGLE_CLOUD_PROJECT</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">config</span> <span class="devsite-syntax-n">get</span> <span class="devsite-syntax-n">project</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">GOOGLE_GENAI_USE_VERTEXAI</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">TRUE</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">GOOGLE_CLOUD_LOCATION</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"us-central1"</span>
</code></pre></devsite-code>
<h2 is-upgraded id="setting-up-permission" data-text="Setting up permission" tabindex="-1">Setting up permission</h2>
<p>üëâüíª Grant Permissions. In the terminal, run :</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/spanner.admin"</span>

<span class="devsite-syntax-c1"># Spanner Database User</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/spanner.databaseUser"</span>

<span class="devsite-syntax-c1"># Artifact Registry Admin</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/artifactregistry.admin"</span>

<span class="devsite-syntax-c1"># Cloud Build Editor</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/cloudbuild.builds.editor"</span>

<span class="devsite-syntax-c1"># Cloud Run Admin</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/run.admin"</span>

<span class="devsite-syntax-c1"># IAM Service Account User</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/iam.serviceAccountUser"</span>

<span class="devsite-syntax-c1"># Vertex AI User</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/aiplatform.user"</span>

<span class="devsite-syntax-c1"># Logging Writer (to allow writing logs)</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/logging.logWriter"</span>


<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/logging.viewer"</span>


</code></pre></devsite-code>
<p>üëâ Validate result in your <a href="https://console.cloud.google.com/iam-admin/" target="_blank">IAM console</a><img alt="Cloud Shell" src="/static/instavibe-adk-multi-agents/img/03-05-iam.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-05-iam_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüíª Run the following commands in the terminal to create a <em>Artifact Registry</em> repository. All Docker images for our agents, the MCP server, and the InstaVibe application are stored here before deployment to Cloud Run or Agent Engine.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">REPO_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"introveally-repo"</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">artifacts</span> <span class="devsite-syntax-n">repositories</span> <span class="devsite-syntax-n">create</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">REPO_NAME</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">repository</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">docker</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">location</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Docker repository for InstaVibe workshop"</span>
</code></pre></devsite-code>
<h2 is-upgraded id="setup-map-platform-for-api-keys" data-text="Setup Map platform for API Keys" tabindex="-1">Setup Map platform for API Keys</h2>
<p>To use Google Maps services in your InstaVibe application, you need to create an API key and restrict it appropriately.</p>
<p>üëâ In a new tab, go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">APIs &amp; Services &gt; Credentials</a>. On the &#34;Credentials&#34; page, click the + CREATE CREDENTIALS button at the top. Select API key from the dropdown menu. <img alt="alt text" src="/static/instavibe-adk-multi-agents/img/03-06-credential.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-06-credential_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ  A dialog box will appear showing your newly created API key. You&#39;ll need it later for your application configuration.</p>
<p>üëâ Click CLOSE on the &#34;API key created&#34; dialog.</p>
<p>üëâ You will see your new API key listed (e.g., &#34;API key 1&#34;). Click on the three dots on the right select <strong>Edit API key</strong> to open the &#34;Restrict and rename API key&#34; page. <img alt="alt text" src="/static/instavibe-adk-multi-agents/img/03-07-edit-from-list.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-07-edit-from-list_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ In the Name field at the top, change the default name to: <strong>Maps Platform API Key</strong> (üö®üö®IMPORTANTüö®üö® Please use this name!)</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">Maps</span> <span class="devsite-syntax-n">Platform</span> <span class="devsite-syntax-n">API</span> <span class="devsite-syntax-n">Key</span>
</code></pre></devsite-code>
<p>üëâ Under the &#34;Application restrictions&#34; section ensure <strong>None</strong> is selected.</p>
<p>üëâ Under the &#34;API restrictions&#34; section, select the Restrict key radio button.</p>
<p>üëâ  Click the Select APIs dropdown menu. In the search box that appears, type <code translate="no" dir="ltr">Maps JavaScript API</code> and select it from the list. <img alt="alt text" src="/static/instavibe-adk-multi-agents/img/03-08-restriction.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-08-restriction_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Click OK.</p>
<p>üëâ Click the SAVE button at the bottom of the page.</p>
<p class="image-container"><img alt="Key Result" src="/static/instavibe-adk-multi-agents/img/03-09-key-result.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/03-09-key-result_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>You have now successfully created an API key named &#34;Maps Platform API Key,&#34; restricted it to only allow usage of the &#34;Maps JavaScript API,&#34; and ensured the API is enabled for your project.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Setup Graph Database" duration="0" step="3">
          
          <h2 class="step-title" id="3" data-text="Setup Graph Database" tabindex="-1">
              4. Setup Graph Database
          </h2>
          <p>Before we can build our intelligent agents, we need a way to store and understand the rich connections within our InstaVibe social network. This is where a Graph Database comes in. Unlike traditional relational databases that store data in tables of rows and columns, a graph database is specifically designed to represent and query data in terms of nodes (like people, events, or posts) and the relationships (edges) that connect them (like friendships, event attendance, or mentions). This structure is incredibly powerful for social media applications because it mirrors the way real-world social networks are structured, making it intuitive to explore how different entities are interconnected.</p>
<p>We are implementing this graph database using Google Cloud Spanner. While Spanner is primarily known as a globally distributed, strongly consistent relational database, it also allows us to define and query graph structures directly on top of our relational tables.</p>
<p>This gives us the combined benefits of Spanner&#39;s scalability, transactional consistency, and familiar SQL interface, along with the expressive power of graph queries for analyzing the complex social dynamics crucial to our AI-powered features.</p>
<p>üëâüíª In Cloud Shell IDE terminal. Provision the necessary infrastructure on Google Cloud. We&#39;ll begin by creating a Spanner Instance, which acts as a dedicated container for our databases. Once the instance is ready, we will then create the actual Spanner Database within it, which will house all our tables and the graph data for InstaVibeÔºö</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">spanner</span> <span class="devsite-syntax-n">instances</span> <span class="devsite-syntax-n">create</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">SPANNER_INSTANCE_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">config</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">regional</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GraphDB Instance InstaVibe"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">processing</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">units</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">100</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">edition</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">ENTERPRISE</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">spanner</span> <span class="devsite-syntax-n">databases</span> <span class="devsite-syntax-n">create</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">SPANNER_DATABASE_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">instance</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">SPANNER_INSTANCE_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">database</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">dialect</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">GOOGLE_STANDARD_SQL</span>
</code></pre></devsite-code>
<p>üëâüíª Grant Spanner read/write access to the default service account</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Granting Spanner read/write access to $</span><span class="devsite-syntax-si">{SERVICE_ACCOUNT_NAME}</span><span class="devsite-syntax-s2"> for database $</span><span class="devsite-syntax-si">{SPANNER_DATABASE_ID}</span><span class="devsite-syntax-s2">..."</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">spanner</span> <span class="devsite-syntax-n">databases</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SPANNER_DATABASE_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">instance</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SPANNER_INSTANCE_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$</span><span class="devsite-syntax-si">{SERVICE_ACCOUNT_NAME}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/spanner.databaseUser"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>üëâüíª Now. We&#39;ll set up a Python virtual environment, install the required Python packages, and then set up the Graph Database schema within Spanner and load it with initial data and run the <code translate="no" dir="ltr">setup.py</code> script.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span>
<span class="devsite-syntax-n">python</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">m</span> <span class="devsite-syntax-n">venv</span> <span class="devsite-syntax-n">env</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">pip</span> <span class="devsite-syntax-n">install</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">r</span> <span class="devsite-syntax-n">requirements</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span>
<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-n">instavibe</span>
<span class="devsite-syntax-n">python</span> <span class="devsite-syntax-n">setup</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">py</span>
</code></pre></devsite-code>
<p>üëâ In a new browser tab, go to the Google Cloud Console, navigate to <a href="https://console.cloud.google.com/spanner" target="_blank">Spanner</a>, you should see a list of your Spanner instances. Click on the <code translate="no" dir="ltr">instavibe-graph-instance</code>. <img alt="spanner instance" src="/static/instavibe-adk-multi-agents/img/04-01-spanner-instance.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-01-spanner-instance_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"> üëâ  On the instance overview page, you&#39;ll see a list of databases within that instance. Click on <code translate="no" dir="ltr">graphdb</code><img alt="spanner db" src="/static/instavibe-adk-multi-agents/img/04-02-spanner-db.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-02-spanner-db_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ  In the left-hand navigation pane for your database, click on Spanner Studio <img alt="spanner studio" src="/static/instavibe-adk-multi-agents/img/04-03-spanner-studio.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-03-spanner-studio_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ  In the query editor (Untitled query tab), paste the following Graph SQL query. This query will find all Person nodes and their direct Friendship relationships with other Person nodes. And click <strong>RUN</strong> to see the result.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-SQL" class="language-SQL" translate="no" dir="ltr"><span class="devsite-syntax-n">Graph</span> <span class="devsite-syntax-n">SocialGraph</span>
<span class="devsite-syntax-n">MATCH</span> <span class="devsite-syntax-n">result_paths</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">((</span><span class="devsite-syntax-n">p</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">f</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Friendship</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">friend</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span><span class="devsite-syntax-p">))</span>
<span class="devsite-syntax-n">RETURN</span> <span class="devsite-syntax-n">SAFE_TO_JSON</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">result_paths</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-n">AS</span> <span class="devsite-syntax-n">result_paths</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="spanner graph" src="/static/instavibe-adk-multi-agents/img/04-04-spanner-graph.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-04-spanner-graph_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ In the same query editor, replace the previous DDL to find people who attended the same event, which implies an indirect connection through a shared activity.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-SQL" class="language-SQL" translate="no" dir="ltr"><span class="devsite-syntax-n">Graph</span> <span class="devsite-syntax-n">SocialGraph</span>
<span class="devsite-syntax-n">MATCH</span> <span class="devsite-syntax-n">result_paths</span> <span class="devsite-syntax-o">=</span>  <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">p1</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">[:</span><span class="devsite-syntax-n">Attended</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Event</span><span class="devsite-syntax-p">)</span>&lt;<span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">[:</span><span class="devsite-syntax-n">Attended</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">p2</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">WHERE</span> <span class="devsite-syntax-n">p1</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">person_id</span> &lt; <span class="devsite-syntax-n">p2</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">person_id</span>
<span class="devsite-syntax-n">RETURN</span> <span class="devsite-syntax-n">SAFE_TO_JSON</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">result_paths</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-n">AS</span> <span class="devsite-syntax-n">result_paths</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="spanner graph" src="/static/instavibe-adk-multi-agents/img/04-05-spanner-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-05-spanner-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ  This query explores a different type of connection, where people mentioned in posts written by friends of a specific person, run the following query in the query editor.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-SQL" class="language-SQL" translate="no" dir="ltr"><span class="devsite-syntax-n">Graph</span> <span class="devsite-syntax-n">SocialGraph</span>
<span class="devsite-syntax-n">MATCH</span> <span class="devsite-syntax-n">result_paths</span> <span class="devsite-syntax-o">=</span>  <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">user</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Alice"</span><span class="devsite-syntax-p">})</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">[:</span><span class="devsite-syntax-n">Friendship</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">friend</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">[:</span><span class="devsite-syntax-n">Wrote</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">post</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Post</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-p">[:</span><span class="devsite-syntax-n">Mentioned</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">mentioned_person</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">Person</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">WHERE</span> <span class="devsite-syntax-n">user</span> &lt;&gt; <span class="devsite-syntax-n">mentioned_person</span> <span class="devsite-syntax-n">AND</span> <span class="devsite-syntax-n">friend</span> &lt;&gt; <span class="devsite-syntax-n">mentioned_person</span> <span class="devsite-syntax-o">--</span> <span class="devsite-syntax-n">Avoid</span> <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">mentions</span> <span class="devsite-syntax-ow">or</span> <span class="devsite-syntax-n">friend</span> <span class="devsite-syntax-n">mentioning</span> <span class="devsite-syntax-n">themselves</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">their</span> <span class="devsite-syntax-n">own</span> <span class="devsite-syntax-n">post</span> <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-ow">not</span> <span class="devsite-syntax-n">intended</span>
<span class="devsite-syntax-n">RETURN</span> <span class="devsite-syntax-n">SAFE_TO_JSON</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">result_paths</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-n">AS</span> <span class="devsite-syntax-n">result_paths</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="spanner graph" src="/static/instavibe-adk-multi-agents/img/04-06-spanner-post.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/04-06-spanner-post_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>These queries offer just a glimpse into the power of using Spanner as a graph database for our InstaVibe application. By modeling our social data as an interconnected graph, we enable sophisticated analysis of relationships and activities, which will be fundamental for our AI agents to understand user context, discover interests, and ultimately provide intelligent social planning assistance.</p>
<p>With our foundational data structure now in place and tested, let&#39;s turn our attention to the existing InstaVibe application that our agents will interact with.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Current state of InstaVibe" duration="0" step="4">
          
          <h2 class="step-title" id="4" data-text="Current state of InstaVibe" tabindex="-1">
              5. Current state of InstaVibe
          </h2>
          <p>To understand where our AI agents will fit in, we first need to deploy and run the existing InstaVibe web application. This application provides the user interface and basic functionalities that connect to the Spanner graph database we&#39;ve already set up.</p>
<p class="image-container"><img alt="home page" src="/static/instavibe-adk-multi-agents/img/05-01-home.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-01-home_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The InstaVibe application uses Google Maps to display event locations visually on its event details pages. To enable this functionality, the application needs the API key we created earlier. The following script will retrieve the actual key string using the display name we assigned (&#34;Maps Platform API Key&#34;).</p>
<p class="image-container"><img alt="event page" src="/static/instavibe-adk-multi-agents/img/05-02-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-02-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüíª  Back in the <em>Cloud shell IDE</em>. Run the script below. Afterwards, carefully check the output to ensure the GOOGLE_MAPS_API_KEY shown matches the key you created and copied from the Google Cloud Console previously.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">KEY_DISPLAY_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Maps Platform API Key"</span>

<span class="devsite-syntax-n">GOOGLE_MAPS_KEY_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">api</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">keys</span> <span class="devsite-syntax-nb">list</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">filter</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"displayName='$</span><span class="devsite-syntax-si">{KEY_DISPLAY_NAME}</span><span class="devsite-syntax-s2">'"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"value(uid)"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">limit</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-n">GOOGLE_MAPS_API_KEY</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">api</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">keys</span> <span class="devsite-syntax-n">get</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">key</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">string</span> <span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{GOOGLE_MAPS_KEY_ID}</span><span class="devsite-syntax-s2">"</span> \
    <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
    <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"value(keyString)"</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{GOOGLE_MAPS_API_KEY}</span><span class="devsite-syntax-s2">"</span> &gt; <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">mapkey</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Retrieved GOOGLE_MAPS_API_KEY: $</span><span class="devsite-syntax-si">{GOOGLE_MAPS_API_KEY}</span><span class="devsite-syntax-s2">"</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="key result" src="/static/instavibe-adk-multi-agents/img/05-07-key.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-07-key_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüíª  Now, let&#39;s build the container image for the InstaVibe web application and push it to our Artifact Registry repository.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">APP_FOLDER_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe-webapp"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">builds</span> <span class="devsite-syntax-n">submit</span> <span class="devsite-syntax-o">.</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">tag</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>üëâüíª  Deploy the new build InstaVibe webapp image to Cloud Run</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">APP_FOLDER_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe-webapp"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">deploy</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">image</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">allow</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">unauthenticated</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"SPANNER_INSTANCE_ID=$</span><span class="devsite-syntax-si">{SPANNER_INSTANCE_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"SPANNER_DATABASE_ID=$</span><span class="devsite-syntax-si">{SPANNER_DATABASE_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"APP_HOST=0.0.0.0"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"APP_PORT=8080"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_LOCATION=$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_MAPS_API_KEY=$</span><span class="devsite-syntax-si">{GOOGLE_MAPS_API_KEY}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">min</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">instances</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">1</span>

</code></pre></devsite-code>
<p>With the deployment successfully completed, the Cloud Run logs should display the public URL for your running InstaVibe application.</p>
<p class="image-container"><img alt="URL" src="/static/instavibe-adk-multi-agents/img/05-08-url.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-08-url_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>You can also find this URL by navigating to the <a href="https://console.cloud.google.com/run" target="_blank">Cloud Run</a> section in the Google Cloud Console and selecting the instavibe service. <img alt="List" src="/static/instavibe-adk-multi-agents/img/05-09-run-list.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-09-run-list_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"><img alt="URL" src="/static/instavibe-adk-multi-agents/img/05-10-run-url.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-10-run-url_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Go ahead and open that URL in your web browser now to explore the basic InstaVibe platform. See the posts, events, and user connections powered by the graph database we set up.</p>
<p>Now that we have our target application running, let&#39;s start building the first intelligent agent to enhance its capabilities.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Basic Agent,Event Planner with ADK" duration="0" step="5">
          
          <h2 class="step-title" id="5" data-text="Basic Agent,Event Planner with ADK" tabindex="-1">
              6. Basic Agent,Event Planner with ADK
          </h2>
          <h2 is-upgraded id="adk-framework" data-text="ADK Framework" tabindex="-1">ADK Framework</h2>
<p><strong>Intro to Google&#39;s ADK Framework</strong> Now that our foundation (the InstaVibe app and database) is set, we can start building our first intelligent agent using Google&#39;s <strong>Agent Development Kit (ADK)</strong>.</p>
<p><strong>Agent Development Kit (ADK)</strong> is a flexible and modular framework specifically designed for developing and deploying AI agents. Its design principle is to make agent development feel more like traditional software development, aiming to make it significantly easier for developers to create, deploy, and orchestrate agentic architectures that can handle everything from simple, single-purpose tasks to complex, multi-agent workflows.</p>
<p>At its core, ADK revolves around the concept of an <code translate="no" dir="ltr">Agent</code>, which encapsulates instructions, configuration (like the chosen language model, e.g., Gemini), and a set of <code translate="no" dir="ltr">Tools</code> it can use to perform actions or gather information.</p>
<p class="image-container"><img alt="06-agent.png" src="/static/instavibe-adk-multi-agents/img/06-agent.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-agent_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Our initial agent will be a &#34;Event Planner.&#34; Its core purpose is to take user requests for social outings (specifying location, dates, and interests) and generate creative, tailored suggestions. To ensure the suggestions are relevant and based on current information (like specific events happening that weekend), we&#39;ll leverage one of ADK&#39;s built-in tools: <strong>Google Search</strong>. This allows the agent to ground its responses in real-time web results, fetching the latest details about venues, events, and activities matching the user&#39;s criteria.</p>
<p>üëâüìù Back in the <em>Cloud shell IDE</em>, in <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/planner/agent.py</code> add the following prompt and instruction to create the agent</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-kn">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">google.adk.agents</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-n">Agent</span>
<span class="devsite-syntax-kn">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">google.adk.tools</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-n">google_search</span>

<span class="devsite-syntax-n">root_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">Agent</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner_agent"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">model</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"gemini-2.0-flash"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Agent tasked with generating creative and fun dating plan suggestions"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">instruction</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>

<span class="devsite-syntax-s2">        You are a specialized AI assistant tasked with generating creative and fun plan suggestions.</span>

<span class="devsite-syntax-s2">        Request:</span>
<span class="devsite-syntax-s2">        For the upcoming weekend, specifically from **[START_DATE_YYYY-MM-DD]** to **[END_DATE_YYYY-MM-DD]**, in the location specified as **[TARGET_LOCATION_NAME_OR_CITY_STATE]** (if latitude/longitude are provided, use these: Lat: **[TARGET_LATITUDE]**, Lon: **[TARGET_LONGITUDE]**), please generate a distinct dating plan suggestions.</span>

<span class="devsite-syntax-s2">        Constraints and Guidelines for Suggestions:</span>
<span class="devsite-syntax-s2">        1.  Creativity &amp; Fun: Plans should be engaging, memorable, and offer a good experience for a date.</span>
<span class="devsite-syntax-s2">        2.  Budget: All generated plans should aim for a moderate budget (conceptually "$$"), meaning they should be affordable yet offer good value, without being overly cheap or extravagant. This budget level should be *reflected in the choice of activities and venues*, but **do not** explicitly state "Budget: $$" in the `plan_description`.</span>
<span class="devsite-syntax-s2">        3.  Interest Alignment:</span>
<span class="devsite-syntax-s2">               Consider the following user interests: **[COMMA_SEPARATED_LIST_OF_INTERESTS, e.g., outdoors, arts &amp; culture, foodie, nightlife, unique local events, live music, active/sports]**. Tailor suggestions specifically to these where possible. The plan should *embody* these interests.</span>
<span class="devsite-syntax-s2">               Fallback: If specific events or venues perfectly matching all listed user interests cannot be found for the specified weekend, you should create a creative and fun generic dating plan that is still appealing, suitable for the location, and adheres to the moderate budget. This plan should still sound exciting and fun, even if it's more general.</span>
<span class="devsite-syntax-s2">        4.  Current &amp; Specific: Prioritize finding specific, current events, festivals, pop-ups, or unique local venues operating or happening during the specified weekend dates. If exact current events cannot be found, suggest appealing evergreen options or implement the fallback generic plan.</span>
<span class="devsite-syntax-s2">        5.  Location Details: For each place or event mentioned within a plan, you MUST provide its name, precise latitude, precise longitude, and a brief, helpful description.</span>
<span class="devsite-syntax-s2">        6.  Maximum Activities: The plan must contain a maximum of 3 distinct activities.</span>

<span class="devsite-syntax-s2">        RETURN PLAN in MARKDOWN FORMAT </span>
<span class="devsite-syntax-s2">    """</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">google_search</span><span class="devsite-syntax-p">]</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>And that&#39;s our first agent defined! One of the great things about ADK is its intuitive nature and the handy tools it provides. A particularly useful one is the <strong>ADK Dev UI</strong>, which allows you to interactively test your agent and see its responses in real-time.</p>
<p>üëâüíª Let&#39;s start it up. The following commands will launch the ADK DEV UI:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">cd</span>  <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">sed</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">i</span> <span class="devsite-syntax-s2">"s|^\(O\?GOOGLE_CLOUD_PROJECT\)=.*|GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">|"</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">env</span>
<span class="devsite-syntax-n">adk</span> <span class="devsite-syntax-n">web</span>
</code></pre></devsite-code>
<p>After running the commands, you should see output in your terminal indicating that the ADK Web Server has started, similar to this:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-o">+-----------------------------------------------------------------------------+</span>
<span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">ADK</span> <span class="devsite-syntax-n">Web</span> <span class="devsite-syntax-n">Server</span> <span class="devsite-syntax-n">started</span>                                                      <span class="devsite-syntax-o">|</span>
<span class="devsite-syntax-o">|</span>                                                                             <span class="devsite-syntax-o">|</span>
<span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">For</span> <span class="devsite-syntax-n">local</span> <span class="devsite-syntax-n">testing</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">access</span> <span class="devsite-syntax-n">at</span> <span class="devsite-syntax-n">http</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-n">localhost</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-mf">8000.</span>                         <span class="devsite-syntax-o">|</span>
<span class="devsite-syntax-o">+-----------------------------------------------------------------------------+</span>

<span class="devsite-syntax-n">INFO</span><span class="devsite-syntax-p">:</span>     <span class="devsite-syntax-n">Application</span> <span class="devsite-syntax-n">startup</span> <span class="devsite-syntax-n">complete</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-n">INFO</span><span class="devsite-syntax-p">:</span>     <span class="devsite-syntax-n">Uvicorn</span> <span class="devsite-syntax-n">running</span> <span class="devsite-syntax-n">on</span> <span class="devsite-syntax-n">http</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-mf">0.0.0.0</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-mi">8000</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">Press</span> <span class="devsite-syntax-n">CTRL</span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-n">C</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">quit</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>üëâ Next, to access the ADK Dev UI from your browser:</p>
<p>From the <strong>Web preview</strong> icon (often looks like an eye or a square with an arrow) in the Cloud Shell toolbar (usually top right), select <strong>Change port</strong>. In the pop-up window, set the port to <strong>8000</strong> and click &#34;Change and Preview&#34;. Cloud Shell will then open a new browser tab or window displaying the ADK Dev UI.</p>
<p class="image-container"><img alt="web preview" src="/static/instavibe-adk-multi-agents/img/05-03-web-preview.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-03-web-preview_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Once the ADK Dev UI is open in your browser: In the top-right dropdown menu of the UI, select <strong>planner</strong> as the agent you want to interact with. Now, in the chat dialog on the right, try giving your agent a task. For example, have a conversation with the agent:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">Search</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-n">something</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">Seattle</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">me</span> <span class="devsite-syntax-n">this</span> <span class="devsite-syntax-n">weekend</span>
</code></pre></devsite-code>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">This</span> <span class="devsite-syntax-n">weekend</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">I</span> <span class="devsite-syntax-n">enjoy</span> <span class="devsite-syntax-n">food</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">anime</span>
</code></pre></devsite-code>
<p>Suggest a date (Your preference)</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">July</span> <span class="devsite-syntax-mi">12</span> <span class="devsite-syntax-mi">2025</span>
</code></pre></devsite-code>
<p>You should see the agent process your request and provide a plan based on its Google Search results.</p>
<p class="image-container"><img alt="adk dev ui" src="/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-04-adk-dev-ui_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<aside class="warning"><p> If you&#39;ve asked for a planning result and it&#39;s taking longer than expected (e.g., several minutes with no output), it&#39;s possible the LLM is taking a bit longer to generate the plan and the ADK developer UI has timed out internally. To resolve this, simply prompt the planning agent to print the plan again.  For example, you can try a simple, direct request like:  &#34;Please repeat the plan.&#34;</p>
</aside>
<p>Now, interacting with an agent is one thing, but how do we know if it&#39;s consistently behaving as expected, especially as we make changes?</p>
<p>Traditional software testing methods often fall short for AI agents because of their generative and non-deterministic nature. To bridge the gap from a cool demo to a reliable production agent, a solid evaluation strategy is crucial. Unlike simply checking the final output of a generative model, <strong>evaluating</strong> an agent often involves assessing its decision-making process and its ability to correctly use tools or follow instructions across various scenarios. ADK provides features to help with this.</p>
<p class="image-container"><img alt="Eval" src="/static/instavibe-adk-multi-agents/img/eval.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/eval_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ In the ADK Dev UI, click on the &#34;Eval&#34; tab in the left-hand navigation. You should see a pre-loaded test file named <code translate="no" dir="ltr">plan_eval</code>. This file contains predefined inputs and criteria for testing our planner agent.</p>
<p>üëâ Select a scenario, such as &#34;boston,&#34; and click the <strong>Run Evaluation</strong> button. In the pop-up window that appears, lower the match score to 0.3 and click Start.</p>
<p class="image-container"><img alt="Match score" src="/static/instavibe-adk-multi-agents/img/05-11-match-score.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-11-match-score_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>This will execute the agent with the test input and check if its output meets the defined expectations. This gives you a way to systematically test your agent&#39;s performance.</p>
<p class="image-container"><img alt="adk dev ui evaluation" src="/static/instavibe-adk-multi-agents/img/05-05-evaluation.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-05-evaluation_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Now, let&#39;s see what happens with a stricter threshold. Select the &#34;nyc&#34; scenario and click <strong>Run Evaluation</strong> again. This time, leave the match score at its default value (Response match score: 0.7) and click Start. You&#39;ll notice the result is Fail. This is expected, as the agent&#39;s creative output doesn&#39;t perfectly match the pre-defined &#34;golden&#34; answer.</p>
<p class="image-container"><img alt="adk dev ui evaluation fail" src="/static/instavibe-adk-multi-agents/img/05-12-fail-eval.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-12-fail-eval_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ To understand why it failed, click on the <strong>fail icon</strong> in &#34;nyc&#34; row. The UI now displays a side-by-side comparison of the Actual response from the agent and the Expected response from the test case. This view is essential for debugging, allowing you to see exactly where the agent&#39;s output diverged and refine its instructions accordingly.</p>
<p>Once you&#39;re done exploring the UI and the evaluation, return to your <em>Cloud Shell Editor</em> terminal and press <code translate="no" dir="ltr">Ctrl+C</code> to stop the ADK Dev UI.</p>
<p>While free-form text output is a good start, for applications like InstaVibe to easily use an agent&#39;s suggestions, structured data (like JSON) is much more practical. Let&#39;s modify our agent to return its plan in a consistent JSON format.</p>
<p>üëâüìù In the <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/planner/agent.py</code>, find the line that currently says <code translate="no" dir="ltr">RETURN PLAN in MARKDOWN FORMAT</code> within the agent&#39;s instruction string. Replace that line with the following detailed JSON structure:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">Return</span> <span class="devsite-syntax-n">your</span> <span class="devsite-syntax-n">response</span> <span class="devsite-syntax-o">*</span><span class="devsite-syntax-n">exclusively</span><span class="devsite-syntax-o">*</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">single</span> <span class="devsite-syntax-n">JSON</span> <span class="devsite-syntax-nb">object</span><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-n">This</span> <span class="devsite-syntax-nb">object</span> <span class="devsite-syntax-n">should</span> <span class="devsite-syntax-n">contain</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">top</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">level</span> <span class="devsite-syntax-n">key</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"fun_plans"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">which</span> <span class="devsite-syntax-n">holds</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-n">objects</span><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-n">Each</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-nb">object</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-n">must</span> <span class="devsite-syntax-n">strictly</span> <span class="devsite-syntax-n">adhere</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">following</span> <span class="devsite-syntax-n">structure</span><span class="devsite-syntax-p">:</span>

        <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">--</span>
        <span class="devsite-syntax-p">{</span>
          <span class="devsite-syntax-s2">"plan_description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"A summary of the overall plan, consisting of **exactly three sentences**. Craft these sentences in a friendly, enthusiastic, and conversational tone, as if you're suggesting this awesome idea to a close friend. Make it sound exciting and personal, highlighting the positive aspects and appeal of the plan without explicitly mentioning budget or listing interest categories."</span><span class="devsite-syntax-p">,</span>
          <span class="devsite-syntax-s2">"locations_and_activities"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-p">[</span>
              <span class="devsite-syntax-p">{</span>
              <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Name of the specific place or event"</span><span class="devsite-syntax-p">,</span>
              <span class="devsite-syntax-s2">"latitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">0.000000</span><span class="devsite-syntax-p">,</span>  <span class="devsite-syntax-o">//</span> <span class="devsite-syntax-n">Replace</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">actual</span> <span class="devsite-syntax-n">latitude</span>
              <span class="devsite-syntax-s2">"longitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">0.000000</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-o">//</span> <span class="devsite-syntax-n">Replace</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">actual</span> <span class="devsite-syntax-n">longitude</span>
              <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"A brief description of this place/event, why it's suitable for the date, and any specific details for the weekend (e.g., opening hours, event time)."</span>
              <span class="devsite-syntax-p">}</span>
              <span class="devsite-syntax-o">//</span> <span class="devsite-syntax-n">Add</span> <span class="devsite-syntax-n">more</span> <span class="devsite-syntax-n">location</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activity</span> <span class="devsite-syntax-n">objects</span> <span class="devsite-syntax-n">here</span> <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-n">involves</span> <span class="devsite-syntax-n">multiple</span> <span class="devsite-syntax-n">stops</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">parts</span>
          <span class="devsite-syntax-p">]</span>
        <span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Now that you&#39;ve updated the agent&#39;s instructions to specifically request JSON output, let&#39;s verify the change.</p>
<p>üëâüíª <strong>Relaunch</strong> the ADK Dev UI using the same command as before:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">cd</span>  <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">adk</span> <span class="devsite-syntax-n">web</span>
</code></pre></devsite-code>
<p><em>Refresh the tab</em> if you already have it open. Or Follow the same steps as previously to open the ADK Dev UI in your browser (via Cloud Shell&#39;s Web Preview on port 8000).  Once the UI is loaded, ensure the planner agent is selected.</p>
<p>üëâ This time, let&#39;s give it a different request. In the chat dialog, enter:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">Plan</span> <span class="devsite-syntax-n">an</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-n">Boston</span> <span class="devsite-syntax-n">this</span> <span class="devsite-syntax-n">weekend</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">art</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">coffee</span>
</code></pre></devsite-code>
<p>Examine the agent&#39;s response carefully. Instead of a purely conversational text reply, you should now see a response formatted strictly as a JSON object, matching the structure we defined in the instructions (containing fun_plans, plan_description, locations_and_activities, etc.). This confirms the agent can now produce structured output suitable for programmatic use by our InstaVibe application.</p>
<p class="image-container"><img alt="adk dev ui json" src="/static/instavibe-adk-multi-agents/img/05-06-json.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/05-06-json_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>After confirming the JSON output, return to your Cloud Shell terminal and press <code translate="no" dir="ltr">Ctrl+C</code> to stop the ADK Dev UI.</p>
<h2 is-upgraded id="adk-components" data-text="ADK Components" tabindex="-1">ADK Components</h2>
<p>While the ADK Dev UI is great for interactive testing, we often need to run our agents programmatically, perhaps as part of a larger application or backend service. To understand how this works, let&#39;s look at some core ADK concepts related to runtime and context management.</p>
<p>Meaningful, multi-turn conversations require agents to understand context ‚Äì recalling what&#39;s been said and done to maintain continuity. ADK provides structured ways to manage this context through <strong>Session</strong>, <strong>State</strong>, and <strong>Memory</strong>:</p>
<ul>
<li><strong>Session:</strong> When a user starts interacting with an agent, a Session is created. Think of it as the container for a single, specific chat thread. It holds a unique ID, the history of interactions (Events), the current working data (State), and metadata like the last update time.</li>
<li><strong>State:</strong> This is the agent&#39;s short-term, working memory within a single Session. It&#39;s a mutable dictionary where the agent can store temporary information needed to complete the current task (e.g., user preferences collected so far, intermediate results from tool calls).</li>
<li><strong>Memory:</strong> This represents the agent&#39;s potential for long-term recall across different sessions or access to external knowledge bases. While Session and State handle the immediate conversation, Memory (often managed by a MemoryService) allows an agent to retrieve information from past interactions or structured data sources, giving it a broader knowledge context. (Note: Our simple client uses in memory services for simplicity, meaning memory/state only persists while the script runs).</li>
<li><strong>Event:</strong> Every interaction within a Session (user message, agent response, tool use request, tool result, state change, error) is recorded as an immutable Event. This creates a chronological log, essentially the transcript and action history of the conversation.</li>
</ul>
<p>So, how are these managed when an agent runs? That&#39;s the job of the <strong>Runner</strong>.</p>
<ul>
<li><strong>Runner</strong>: The Runner is the core execution engine provided by ADK. You define your agent and the tools it uses, and the Runner orchestrates the process of fulfilling a user&#39;s request. It manages the Session, handles the flow of Events, updates the State, invokes the underlying language model, coordinates tool calls, and potentially interacts with MemoryService. Think of it as the conductor making sure all the different parts work together correctly.</li>
</ul>
<p>We can use the Runner to run our agent as a standalone Python application, completely independent of the Dev UI.</p>
<p>Let&#39;s create a simple client script to invoke our planner agent programmatically.</p>
<p>üëâüìù In the file <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/planner/planner_client.py</code>, add the following Python code under the existing imports. In <code translate="no" dir="ltr">planner_client.py</code>, under the imports, add the following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">async</span> <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">async_main</span><span class="devsite-syntax-p">():</span>
  <span class="devsite-syntax-n">session_service</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">InMemorySessionService</span><span class="devsite-syntax-p">()</span>

  <span class="devsite-syntax-n">session</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-k">await</span> <span class="devsite-syntax-n">session_service</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">create_session</span><span class="devsite-syntax-p">(</span>
      <span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">{},</span> <span class="devsite-syntax-n">app_name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'planner_app'</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">user_id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'user_dc'</span>
  <span class="devsite-syntax-p">)</span>

  <span class="devsite-syntax-n">query</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-s2">"Plan Something for me in San Francisco this weekend on wine and fashion "</span>
  <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"User Query: '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">'"</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-n">content</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Content</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'user'</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">parts</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Part</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-p">)])</span>

  <span class="devsite-syntax-n">root_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">root_agent</span>
  <span class="devsite-syntax-n">runner</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">Runner</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-n">app_name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'planner_app'</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">root_agent</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">session_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">session_service</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"Running agent..."</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-n">events_async</span> <span class="devsite-syntax-o">=</span>  <span class="devsite-syntax-n">runner</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">run_async</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">session_id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">session</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">user_id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">session</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">user_id</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">new_message</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">content</span>
  <span class="devsite-syntax-p">)</span>

  <span class="devsite-syntax-k">async</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">events_async</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Event received: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">event</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>


<span class="devsite-syntax-k">if</span> <span class="devsite-syntax-vm">__name__</span> <span class="devsite-syntax-o">==</span> <span class="devsite-syntax-s1">'__main__'</span><span class="devsite-syntax-p">:</span>
  <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">asyncio</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">run</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">async_main</span><span class="devsite-syntax-p">())</span>
  <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-ne">Exception</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"An error occurred: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>This code sets up in-memory services for session and artifact management (keeping it simple for this example), creates a session, defines a user query, configures the Runner with our agent, and then runs the agent asynchronously, printing out each event generated during the execution.</p>
<p>üëâüíª Now, execute this client script from your terminal:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">cd</span>  <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">python</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">m</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">planner_client</span>
</code></pre></devsite-code>
<p>üëÄ Observe the output. Instead of just the final JSON plan, you&#39;ll see the detailed structure of each Event object generated during the agent&#39;s execution flow. This includes the initial user message event, potential events related to tool calls (like Google Search), and finally, the model&#39;s response event containing the JSON plan. This detailed event stream is very useful for debugging and understanding the step-by-step processing happening within the ADK Runtime.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-log" class="language-log" translate="no" dir="ltr"><span class="devsite-syntax-n">Running</span> <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-n">Event</span> <span class="devsite-syntax-n">received</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">content</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">Content</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">parts</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">Part</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">video_metadata</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">thought</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">code_execution_result</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">executable_code</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">file_data</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">function_call</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">function_response</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">inline_data</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'```json</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s1">{</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s1"> "fun_plans": [</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s1">  {</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s1">   "plan_description": "Embark on a stylish adventure through Hayes Valley, </span>
<span class="devsite-syntax-o">...</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">turncated</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">offering</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">variety</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">fashion</span> <span class="devsite-syntax-n">styles</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">browse</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">enjoy</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2">    }</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2">   ]</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2">  }</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2"> ]</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2">}</span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2">```')], role='model') grounding_metadata=GroundingMetadata(grounding_chunks=[GroundingChunk(retrieved_context=None, web=GroundingChunkWeb(domain='islands.com', title='islands.com', uri='http</span>
<span class="devsite-syntax-o">...</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">turncated</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">QyTpPV7jS6wUt</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">Ix7GuP2mC9J4eY_8Km6Vv44liF9cb2VSs</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'))], grounding_supports=[GroundingSupport(confide</span>
<span class="devsite-syntax-o">...</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">turncated</span><span class="devsite-syntax-p">)</span>
&gt;\<span class="devsite-syntax-n">n</span><span class="devsite-syntax-s1">', sdk_blob=None), web_search_queries=['</span><span class="devsite-syntax-o">..</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-s1">']) partial=None turn_complete=None error_code=None error_message=None interrupted=None custom_metadata=None invocation_id='</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mi">04</span><span class="devsite-syntax-n">d97b8b</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mi">9021</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mi">47</span><span class="devsite-syntax-n">a5</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">ab41</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mi">17</span><span class="devsite-syntax-n">b5cbb4bf03</span><span class="devsite-syntax-s1">' author='</span><span class="devsite-syntax-n">location_search_agent</span><span class="devsite-syntax-s1">' actions=EventActions(skip_summarization=None, state_delta=</span><span class="devsite-syntax-si">{}</span><span class="devsite-syntax-s1">, artifact_delta=</span><span class="devsite-syntax-si">{}</span><span class="devsite-syntax-s1">, transfer_to_agent=None, escalate=None, requested_auth_configs=</span><span class="devsite-syntax-si">{}</span><span class="devsite-syntax-s1">) long_running_tool_ids=None branch=None id='</span><span class="devsite-syntax-n">CInHdkKw</span><span class="devsite-syntax-s1">' timestamp=1746978846.232674</span>
</code></pre></devsite-code>
<p>If the script runs continuously or hangs, you might need to manually stop it by pressing <code translate="no" dir="ltr">Ctrl+C</code>.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Platform Interaction Agent - interact with MCP Server" duration="0" step="6">
          
          <h2 class="step-title" id="6" data-text="Platform Interaction Agent - interact with MCP Server" tabindex="-1">
              7. Platform Interaction Agent - interact with MCP Server
          </h2>
          <p>While ADK helps structure our agents, they often need to interact with external systems or APIs to perform real-world actions.</p>
<h2 is-upgraded id="model-context-protocol-mcp" data-text="Model Context Protocol (MCP)" tabindex="-1">Model Context Protocol (MCP)</h2>
<p>The Model Context Protocol (MCP) is an open standard designed to standardize how AI applications like agents, connect with external data sources, tools, and systems. It aims to solve the problem of needing custom integrations for every AI application and data source combination by providing a universal interface. MCP utilizes a client-server architecture where MCP clients, residing within AI applications (hosts), manage connections to MCP servers. These servers are external programs that expose specific functionalities like accessing local data, interacting with remote services via APIs, or providing predefined prompts, allowing AI models to access current information and perform tasks beyond their initial training. This structure enables AI models to discover and interact with external capabilities in a standardized way, making integrations simpler and more scalable.</p>
<p><strong>Build and deploy the InstaVibe MCP server</strong></p>
<p class="image-container"><img alt="07-mcp-server.png" src="/static/instavibe-adk-multi-agents/img/07-mcp-server.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Our agents will eventually need to interact with the InstaVibe platform itself.Specifically, to create posts and register events using the platform&#39;s existing APIs. The InstaVibe application already exposes these functionalities via standard HTTP endpoints:</p>
<table class="vertical-rules">
<tr><td colspan="1" rowspan="1"><p>Enpoint</p>
</td><td colspan="1" rowspan="1"><p>URL</p>
</td><td colspan="1" rowspan="1"><p>HTTP method</p>
</td><td colspan="1" rowspan="1"><p>Description</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Create Post</p>
</td><td colspan="1" rowspan="1"><p>api/posts</p>
</td><td colspan="1" rowspan="1"><p>POST</p>
</td><td colspan="1" rowspan="1"><p>API endpoint to add a new post. Expects JSON body: <br><code translate="no" dir="ltr">{"author_name": "...", "text": "...", "sentiment": "..." (optional)}</code></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Create Event</p>
</td><td colspan="1" rowspan="1"><p>api/events</p>
</td><td colspan="1" rowspan="1"><p>POST</p>
</td><td colspan="1" rowspan="1"><p>API endpoint to add a new event and its attendees (simplified schema). <br> Expects JSON body: <code translate="no" dir="ltr">{ "event_name": "...", "description": "...", "event_date": "YYYY-MM-DDTHH:MM:SSZ", "locations": [  {"name": "...", "description": "...", "latitude": 0.0, "longitude": 0.0, "address": "..."} ], "attendee_names": ["...", "..."] }</code></p>
</td></tr>
</table>
<p>To make these capabilities available to our agents via MCP, we first need to create simple Python functions that act as wrappers around these API calls. These functions will handle the HTTP request logic.</p>
<p>üëâ First, let&#39;s implement the wrapper function for creating a post. Open the file <code translate="no" dir="ltr">~/instavibe-bootstrap/tools/instavibe/instavibe.py</code> and replace the <code translate="no" dir="ltr">#REPLACE ME CREATE POST</code> comment with the following Python code:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">create_post</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">author_name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">text</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">sentiment</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">base_url</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">BASE_URL</span><span class="devsite-syntax-p">):</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">    Sends a POST request to the /posts endpoint to create a new post.</span>

<span class="devsite-syntax-sd">    Args:</span>
<span class="devsite-syntax-sd">        author_name (str): The name of the post's author.</span>
<span class="devsite-syntax-sd">        text (str): The content of the post.</span>
<span class="devsite-syntax-sd">        sentiment (str): The sentiment associated with the post (e.g., 'positive', 'negative', 'neutral').</span>
<span class="devsite-syntax-sd">        base_url (str, optional): The base URL of the API. Defaults to BASE_URL.</span>

<span class="devsite-syntax-sd">    Returns:</span>
<span class="devsite-syntax-sd">        dict: The JSON response from the API if the request is successful.</span>
<span class="devsite-syntax-sd">              Returns None if an error occurs.</span>

<span class="devsite-syntax-sd">    Raises:</span>
<span class="devsite-syntax-sd">        requests.exceptions.RequestException: If there's an issue with the network request (e.g., connection error, timeout).</span>
<span class="devsite-syntax-sd">    """</span>
    <span class="devsite-syntax-n">url</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">base_url</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">/posts"</span>
    <span class="devsite-syntax-n">headers</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"Content-Type"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"application/json"</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">payload</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span>
        <span class="devsite-syntax-s2">"author_name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">author_name</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">text</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-s2">"sentiment"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">sentiment</span>
    <span class="devsite-syntax-p">}</span>

    <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">response</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">requests</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">post</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">url</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">headers</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">headers</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">payload</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">raise_for_status</span><span class="devsite-syntax-p">()</span>  <span class="devsite-syntax-c1"># Raise an exception for bad status codes (4xx or 5xx)</span>
        <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Successfully created post. Status Code: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">status_code</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">json</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-n">requests</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">exceptions</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">RequestException</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Error creating post: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-c1"># Optionally re-raise the exception if the caller needs to handle it</span>
        <span class="devsite-syntax-c1"># raise e</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">JSONDecodeError</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Error decoding JSON response from </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">url</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">. Response text: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>
</code></pre></devsite-code>
<p>üëâüìù Next, we&#39;ll create the wrapper function for the event creation API. In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/tools/instavibe/instavibe.py</code> file, replace the <code translate="no" dir="ltr">#REPLACE ME CREATE EVENTS</code> comment with this code:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">create_event</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">event_name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">description</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">event_date</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">locations</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">attendee_names</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">],</span> <span class="devsite-syntax-n">base_url</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">BASE_URL</span><span class="devsite-syntax-p">):</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">    Sends a POST request to the /events endpoint to create a new event registration.</span>

<span class="devsite-syntax-sd">    Args:</span>
<span class="devsite-syntax-sd">        event_name (str): The name of the event.</span>
<span class="devsite-syntax-sd">        description (str): The detailed description of the event.</span>
<span class="devsite-syntax-sd">        event_date (str): The date and time of the event (ISO 8601 format recommended, e.g., "2025-06-10T09:00:00Z").</span>
<span class="devsite-syntax-sd">        locations (list): A list of location dictionaries. Each dictionary should contain:</span>
<span class="devsite-syntax-sd">                          'name' (str), 'description' (str, optional),</span>
<span class="devsite-syntax-sd">                          'latitude' (float), 'longitude' (float),</span>
<span class="devsite-syntax-sd">                          'address' (str, optional).</span>
<span class="devsite-syntax-sd">        attendee_names (list[str]): A list of names of the people attending the event.</span>
<span class="devsite-syntax-sd">        base_url (str, optional): The base URL of the API. Defaults to BASE_URL.</span>

<span class="devsite-syntax-sd">    Returns:</span>
<span class="devsite-syntax-sd">        dict: The JSON response from the API if the request is successful.</span>
<span class="devsite-syntax-sd">              Returns None if an error occurs.</span>

<span class="devsite-syntax-sd">    Raises:</span>
<span class="devsite-syntax-sd">        requests.exceptions.RequestException: If there's an issue with the network request (e.g., connection error, timeout).</span>
<span class="devsite-syntax-sd">    """</span>
    <span class="devsite-syntax-n">url</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">base_url</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">/events"</span>
    <span class="devsite-syntax-n">headers</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"Content-Type"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"application/json"</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">payload</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span>
        <span class="devsite-syntax-s2">"event_name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">event_name</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">description</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-s2">"event_date"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">event_date</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-s2">"locations"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">locations</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-s2">"attendee_names"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">attendee_names</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-p">}</span>

    <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">response</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">requests</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">post</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">url</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">headers</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">headers</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">payload</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">raise_for_status</span><span class="devsite-syntax-p">()</span>  <span class="devsite-syntax-c1"># Raise an exception for bad status codes (4xx or 5xx)</span>
        <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Successfully created event registration. Status Code: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">status_code</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">json</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-n">requests</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">exceptions</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">RequestException</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Error creating event registration: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-c1"># Optionally re-raise the exception if the caller needs to handle it</span>
        <span class="devsite-syntax-c1"># raise e</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">JSONDecodeError</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Error decoding JSON response from </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">url</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">. Response text: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>
</code></pre></devsite-code>
<p>As you can see, these functions are straightforward wrappers around the existing InstaVibe APIs. This pattern is useful, if you already have APIs for your services, you can easily expose their functionality as tools for agents by creating such wrappers.</p>
<p><strong>MCP Server Implementation</strong></p>
<p>Now that we have the Python functions that perform the actions (calling the InstaVibe APIs), we need to build the MCP Server component. This server will expose these functions as &#34;tools&#34; according to the MCP standard, allowing MCP clients (like our agents) to discover and invoke them.</p>
<p>An MCP Server typically implements two key functionalities:</p>
<ul>
<li><strong>list_tools</strong>: responsible for allowing the client to discover the available tools on the server, providing metadata like their names, descriptions, and required parameters, often defined using JSON Schema</li>
<li><strong>call_tool</strong>: handles the execution of a specific tool requested by the client, receiving the tool&#39;s name and arguments and performing the corresponding action, such as in our case interacting with an API</li>
</ul>
<p>MCP servers are used to provide AI models with access to real-world data and actions, enabling tasks like sending emails, creating tasks in project management systems, searching databases, or interacting with various software and web services. While initial implementations often focused on local servers communicating via standard <em>input/output (stdio)</em> for simplicity, particularly in development or &#34;studio&#34; environments, the move towards remote servers utilizing protocols like HTTP with Server-Sent Events (SSE) makes more sense for broader adoption and enterprise use cases.</p>
<p>The remote architecture, despite the added network communication layer, offers significant advantages: it allows multiple AI clients to share access to a single server, centralizes management and updates of tools, enhances security by keeping sensitive data and API keys on the server side rather than distributed across potentially many client machines, and decouples the AI model from the specifics of the external system integration, making the entire ecosystem more scalable, secure, and maintainable than requiring every AI instance to manage its own direct integrations.</p>
<p class="image-container"><img alt="07-mcp-server.png" src="/static/instavibe-adk-multi-agents/img/07-mcp-server-01.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/07-mcp-server-01_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>We will implement our MCP server using HTTP and Server-Sent Events (SSE) for communication, which is well-suited for potentially long-running tool executions and enterprise scenarios.</p>
<p>üëâüìù First, let&#39;s implement the list_tools endpoint. Open the file <code translate="no" dir="ltr">~/instavibe-bootstrap/tools/instavibe/mcp_server.py</code> and replace the <code translate="no" dir="ltr">#REPLACE ME - LIST TOOLS</code> comment with the following code. :</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-nd">@app</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">list_tools</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-k">async</span> <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">list_tools</span><span class="devsite-syntax-p">()</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Tool</span><span class="devsite-syntax-p">]:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-sd">"""MCP handler to list available tools."""</span>
  <span class="devsite-syntax-c1"># Convert the ADK tool's definition to MCP format</span>
  <span class="devsite-syntax-n">mcp_tool_schema_event</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">adk_to_mcp_tool_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">event_tool</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-n">mcp_tool_schema_post</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">adk_to_mcp_tool_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">post_tool</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"MCP Server: Received list_tools request. </span><span class="devsite-syntax-se">\n</span><span class="devsite-syntax-s2"> MCP Server: Advertising tool: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">mcp_tool_schema_event</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> and </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">mcp_tool_schema_post</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">mcp_tool_schema_event</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">mcp_tool_schema_post</span><span class="devsite-syntax-p">]</span>
</code></pre></devsite-code>
<p>This function defines the tools (create_event, create_post) and tells connecting clients about them.</p>
<p>üëâüìù Next, implement the <code translate="no" dir="ltr">call_tool</code> endpoint, which handles the actual execution requests from clients. In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/tools/instavibe/mcp_server.py</code> file, replace the <code translate="no" dir="ltr">#REPLACE ME - CALL TOOLS</code>comment with this code.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-nd">@app</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">call_tool</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-k">async</span> <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">call_tool</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">arguments</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">dict</span>
<span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TextContent</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">ImageContent</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">EmbeddedResource</span><span class="devsite-syntax-p">]:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-sd">"""MCP handler to execute a tool call."""</span>
  <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"MCP Server: Received call_tool request for '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">' with args: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">arguments</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>

  <span class="devsite-syntax-c1"># Look up the tool by name in our dictionary</span>
  <span class="devsite-syntax-n">tool_to_call</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">available_tools</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">tool_to_call</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
      <span class="devsite-syntax-n">adk_response</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-k">await</span> <span class="devsite-syntax-n">tool_to_call</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">run_async</span><span class="devsite-syntax-p">(</span>
          <span class="devsite-syntax-n">args</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">arguments</span><span class="devsite-syntax-p">,</span>
          <span class="devsite-syntax-n">tool_context</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-c1"># No ADK context available here</span>
      <span class="devsite-syntax-p">)</span>
      <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"MCP Server: ADK tool '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">' executed successfully."</span><span class="devsite-syntax-p">)</span>
      
      <span class="devsite-syntax-n">response_text</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">dumps</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">adk_response</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">indent</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-p">)</span>
      <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TextContent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nb">type</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">response_text</span><span class="devsite-syntax-p">)]</span>

    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-ne">Exception</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
      <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"MCP Server: Error executing ADK tool '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">': </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
      <span class="devsite-syntax-c1"># Creating a proper MCP error response might be more robust</span>
      <span class="devsite-syntax-n">error_text</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">dumps</span><span class="devsite-syntax-p">({</span><span class="devsite-syntax-s2">"error"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Failed to execute tool '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">': </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">})</span>
      <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TextContent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nb">type</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">error_text</span><span class="devsite-syntax-p">)]</span>
  <span class="devsite-syntax-k">else</span><span class="devsite-syntax-p">:</span>
      <span class="devsite-syntax-c1"># Handle calls to unknown tools</span>
      <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"MCP Server: Tool '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">' not found."</span><span class="devsite-syntax-p">)</span>
      <span class="devsite-syntax-n">error_text</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">json</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">dumps</span><span class="devsite-syntax-p">({</span><span class="devsite-syntax-s2">"error"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Tool '</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">' not implemented."</span><span class="devsite-syntax-p">})</span>
      <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">mcp_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TextContent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nb">type</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">error_text</span><span class="devsite-syntax-p">)]</span>
</code></pre></devsite-code>
<p>This function receives the tool name and arguments, finds the corresponding Python wrapper function we defined earlier, executes it, and returns the result</p>
<p>üëâüíª With the MCP server logic defined, we now need to package it as a container, in the terminal run the following script to build the Docker image using Cloud Build:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span>

<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">MCP_IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"mcp-tool-server"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{MCP_IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"mcp-tool-server"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">INSTAVIBE_BASE_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">api</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">builds</span> <span class="devsite-syntax-n">submit</span> <span class="devsite-syntax-o">.</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">tag</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>üëâüíª And deploy the image as a service on Google Cloud Run.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span>

<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">MCP_IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"mcp-tool-server"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{MCP_IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"mcp-tool-server"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">INSTAVIBE_BASE_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">api</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">deploy</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">image</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">allow</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">unauthenticated</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"INSTAVIBE_BASE_URL=$</span><span class="devsite-syntax-si">{INSTAVIBE_BASE_URL}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"APP_HOST=0.0.0.0"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"APP_PORT=8080"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_GENAI_USE_VERTEXAI=TRUE"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_LOCATION=$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">min</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">instances</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">1</span>
</code></pre></devsite-code>
<p>üëâüíª After the deployment completed successfully, the MCP server will be running and accessible via a public URL. We need to capture this URL so our agent (acting as an MCP client) knows where to connect.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">MCP_SERVER_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">tool</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">sse</span>
</code></pre></devsite-code>
<p>You should also now be able to see the mcp-tool-server service listed as &#34;Running&#34; in the <a href="https://console.cloud.google.com/run" target="_blank">Cloud Run</a> section of your Google Cloud Console.</p>
<p class="image-container"><img alt="Cloud run" src="/static/instavibe-adk-multi-agents/img/06-01-cloud-run.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/06-01-cloud-run_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>With the MCP server deployed and its URL captured, we can now implement the agent that will act as an MCP client and utilize the tools exposed by this server.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Platform Interaction Agent (using MCP)" duration="0" step="7">
          
          <h2 class="step-title" id="7" data-text="Platform Interaction Agent (using MCP)" tabindex="-1">
              8. Platform Interaction Agent (using MCP)
          </h2>
          <p><strong>MCP Client</strong> The MCP Client is a component that resides within an AI application or agent, acting as the interface between the AI model and one or more MCP Servers; in our implementation, this client will be integrated directly within our agent. This client&#39;s primary function is to communicate with MCP Servers to discover available tools via the <code translate="no" dir="ltr">list_tools</code> function and subsequently request the execution of specific tools using the <code translate="no" dir="ltr">call_tool</code> function, passing necessary arguments provided by the AI model or the agent orchestrating the call.</p>
<p class="image-container"><img alt="MCP Client" src="/static/instavibe-adk-multi-agents/img/08-agent.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-agent_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Now we&#39;ll build the agent that acts as the MCP Client. This agent, running within the ADK framework, will be responsible for communicating with the <code translate="no" dir="ltr">mcp-tool-server</code> we just deployed.</p>
<p>üëâ First, we need to modify the agent definition to dynamically fetch the tools from our running MCP server. In <code translate="no" dir="ltr">agents/platform_mcp_client/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE ME - FETCH TOOLS</code> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-sd">"""Gets tools from the File System MCP Server."""</span>
  <span class="devsite-syntax-n">tools</span> <span class="devsite-syntax-o">=</span>  <span class="devsite-syntax-n">MCPToolset</span><span class="devsite-syntax-p">(</span>
      <span class="devsite-syntax-n">connection_params</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">SseServerParams</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">url</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">MCP_SERVER_URL</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">headers</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">{})</span>
  <span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>This code uses the MCPToolset.from_server method to connect to the MCP_SERVER_URL (which we set as an environment variable earlier) and retrieve the list of available tools.</p>
<p>Next, we need to tell the ADK agent definition to actually use these dynamically fetched tools.</p>
<p>üëâ In <code translate="no" dir="ltr">agents/platform_mcp_client/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE ME - SET TOOLs</code> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr">  <span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-p">],</span>
</code></pre></devsite-code>
<p>üëâüíª Now, let&#39;s test this agent locally using the ADK Dev UI to see if it can correctly connect to the MCP server and use the tools to interact with our running InstaVibe application.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">MCP_SERVER_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">tool</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">sse</span>

<span class="devsite-syntax-n">cd</span>  <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">sed</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">i</span> <span class="devsite-syntax-s2">"s|^\(O\?GOOGLE_CLOUD_PROJECT\)=.*|GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">|"</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">platform_mcp_client</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">env</span>
<span class="devsite-syntax-n">sed</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">i</span> <span class="devsite-syntax-s2">"s|^\(O\?MCP_SERVER_URL\)=.*|MCP_SERVER_URL=$</span><span class="devsite-syntax-si">{MCP_SERVER_URL}</span><span class="devsite-syntax-s2">|"</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">platform_mcp_client</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">env</span>
<span class="devsite-syntax-n">adk</span> <span class="devsite-syntax-n">web</span>
</code></pre></devsite-code>
<p>Open the ADK Dev UI in your browser again (using Cloud Shell&#39;s Web Preview on port 8000). This time, in the top-right dropdown, select the <code translate="no" dir="ltr">platform_mcp_client</code> agent.</p>
<p>Let&#39;s test the create_post tool. In the chat dialog, enter the following request:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">Create</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">post</span> <span class="devsite-syntax-n">saying</span> <span class="devsite-syntax-s2">"Y'all I just got the cutest lil void baby üò≠‚ú® Naming him Abyss bc he's deep, mysterious, and lowkey chaotic üî•üñ§ #VoidCat #NewRoomie"</span> <span class="devsite-syntax-n">I</span><span class="devsite-syntax-s1">'m Julia</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="ADK Dev UI Post" src="/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-01-adk-dev-ui-post_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The agent should process this, identify the need to use the create_post tool, communicate with the MCP server, which in turn calls the InstaVibe API.</p>
<p>üëâ Verification Step: After the agent confirms the action, open the tab where your InstaVibe application is running (or refresh it). You should see the new post from &#34;Julia&#34; appear on the main feed!</p>
<p class="image-container"><img alt="InstaVibe Post" src="/static/instavibe-adk-multi-agents/img/08-02-instavibe-post.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-02-instavibe-post_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüíª Run this script in a <strong>separate</strong> terminal to get Instavibe link if needed:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">instavibe</span>
</code></pre></devsite-code>
<p>üëâüìù Now, let&#39;s test the create_event tool. Enter the following multi-line request into the chat dialog:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">Hey</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">can</span> <span class="devsite-syntax-n">you</span> <span class="devsite-syntax-nb">set</span> <span class="devsite-syntax-n">up</span> <span class="devsite-syntax-n">an</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">Hannah</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">George</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">me</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">I</span><span class="devsite-syntax-s1">'m Julia? Let'</span><span class="devsite-syntax-n">s</span> <span class="devsite-syntax-n">call</span> <span class="devsite-syntax-n">it</span> <span class="devsite-syntax-s1">'Mexico City Culinary &amp; Art Day'</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-n">here</span> <span class="devsite-syntax-n">are</span> <span class="devsite-syntax-n">more</span> <span class="devsite-syntax-n">info</span>
  <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"event_name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Mexico City Culinary &amp; Art Day"</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"A vibrant day in Mexico City for Hannah and George, starting with lunch at one of the city's best taco spots in the hip Condesa neighborhood, followed by an inspiring afternoon exploring the Museo Soumaya's stunning art collection."</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-s2">"event_date"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"2025-10-17T12:00:00-06:00"</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-s2">"locations"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-p">[</span>
    <span class="devsite-syntax-p">{</span>
      <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"El Tizoncito"</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Considered one of the original creators of tacos al pastor, El Tizoncito offers a legendary taco experience in the heart of Condesa. Their flavorful meats, house salsas, and casual vibe make it a must-visit for foodies."</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"latitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">19.412179</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"longitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-mf">99.171308</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"address"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Av. Tamaulipas 122, Hip√≥dromo, Cuauht√©moc, 06100 Ciudad de M√©xico, CDMX, Mexico"</span>
    <span class="devsite-syntax-p">},</span>
    <span class="devsite-syntax-p">{</span>
      <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Museo Soumaya"</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"An architectural icon in Mexico City, Museo Soumaya houses over 66,000 works of art, including pieces by Rodin, Dal√≠, and Rivera. The striking silver structure is a cultural landmark and a visual feast inside and out."</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"latitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">19.440056</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"longitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-mf">99.204281</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"address"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Plaza Carso, Blvd. Miguel de Cervantes Saavedra 303, Granada, Miguel Hidalgo, 11529 Ciudad de M√©xico, CDMX, Mexico"</span>
    <span class="devsite-syntax-p">}</span>
  <span class="devsite-syntax-p">],</span>
  <span class="devsite-syntax-s2">"attendee_names"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"Hannah"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"George"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">Julia</span><span class="devsite-syntax-p">],</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Again, the agent should use the appropriate tool via the MCP server. In the Events tab, feel free to click on the indiviual event, you will see a detailed, step-by-step trace of the execution.</p>
<p class="image-container"><img alt="ADK Dev UI Event" src="/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-03-adk-dev-ui-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Verification Step: Go back to your running InstaVibe application and navigate to the &#34;Events&#34; section (or equivalent). You should now see the newly created &#34;Mexico City Culinary &amp; Art Day&#34; event listed.</p>
<p class="image-container"><img alt="InstaVibe Event" src="/static/instavibe-adk-multi-agents/img/08-04-instavibe-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/08-04-instavibe-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>This successfully demonstrates how MCP allows our agent to leverage external tools (in this case, InstaVibe&#39;s APIs) in a standardized way.</p>
<p>Once you&#39;ve verified both actions, return to your Cloud Shell terminal and press <code translate="no" dir="ltr">Ctrl+C</code>to stop the ADK Dev UI.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Workflow Agent and Multi-Agents in ADK" duration="0" step="8">
          
          <h2 class="step-title" id="8" data-text="Workflow Agent and Multi-Agents in ADK" tabindex="-1">
              9. Workflow Agent and Multi-Agents in ADK
          </h2>
          <p>Our agents so far can plan outings and interact with the platform. However, truly personalized planning requires understanding the user&#39;s social circle. For busy users who might not closely follow their friends&#39; activities, gathering this context manually is difficult. To address this, we&#39;ll build a Social Profiling agent that leverages our Spanner Graph Database to analyze friend activities and interests, enabling more tailored suggestions.</p>
<p class="image-container"><img alt="Social Profiling Agent" src="/static/instavibe-adk-multi-agents/img/09-agent-01.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-01_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>First, we need tools for this agent to access the graph data.</p>
<p>üëâüìù Add the following Python functions to the end of the file <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/instavibe.py</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_person_attended_events</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">person_id</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-nb">dict</span><span class="devsite-syntax-p">]:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">    Fetches events attended by a specific person using Graph Query.</span>
<span class="devsite-syntax-sd">    Args:</span>
<span class="devsite-syntax-sd">       person_id (str): The ID of the person whose posts to fetch.</span>
<span class="devsite-syntax-sd">    Returns: list[dict] or None.</span>
<span class="devsite-syntax-sd">    """</span>
    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-ow">not</span> <span class="devsite-syntax-n">db_instance</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>

    <span class="devsite-syntax-n">graph_sql</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">        Graph SocialGraph</span>
<span class="devsite-syntax-s2">        MATCH (p:Person)-[att:Attended]-&gt;(e:Event)</span>
<span class="devsite-syntax-s2">        WHERE p.person_id = @person_id</span>
<span class="devsite-syntax-s2">        RETURN e.event_id, e.name, e.event_date, att.attendance_time</span>
<span class="devsite-syntax-s2">        ORDER BY e.event_date DESC</span>
<span class="devsite-syntax-s2">    """</span>
    <span class="devsite-syntax-n">params</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">person_id</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">param_types_map</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">STRING</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">fields</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"event_id"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"event_date"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"attendance_time"</span><span class="devsite-syntax-p">]</span>

    <span class="devsite-syntax-n">results</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">run_graph_query</span><span class="devsite-syntax-p">(</span> <span class="devsite-syntax-n">graph_sql</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">param_types_map</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">expected_fields</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">fields</span><span class="devsite-syntax-p">)</span>

    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">results</span> <span class="devsite-syntax-ow">is</span> <span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>

    <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">results</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-nb">isinstance</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">event</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s1">'event_date'</span><span class="devsite-syntax-p">),</span> <span class="devsite-syntax-n">datetime</span><span class="devsite-syntax-p">):</span>
            <span class="devsite-syntax-n">event</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'event_date'</span><span class="devsite-syntax-p">]</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">event</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'event_date'</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isoformat</span><span class="devsite-syntax-p">()</span>
        <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-nb">isinstance</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">event</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s1">'attendance_time'</span><span class="devsite-syntax-p">),</span> <span class="devsite-syntax-n">datetime</span><span class="devsite-syntax-p">):</span>
            <span class="devsite-syntax-n">event</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'attendance_time'</span><span class="devsite-syntax-p">]</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">event</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'attendance_time'</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isoformat</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">results</span>

<span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_person_id_by_name</span><span class="devsite-syntax-p">(</span> <span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">    Fetches the person_id for a given name using SQL.</span>

<span class="devsite-syntax-sd">    Args:</span>
<span class="devsite-syntax-sd">       name (str): The name of the person to search for.</span>

<span class="devsite-syntax-sd">    Returns:</span>
<span class="devsite-syntax-sd">        str or None: The person_id if found, otherwise None.</span>
<span class="devsite-syntax-sd">                     Returns the ID of the *first* match if names are duplicated.</span>
<span class="devsite-syntax-sd">    """</span>
    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-ow">not</span> <span class="devsite-syntax-n">db_instance</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>

    <span class="devsite-syntax-n">sql</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">        SELECT person_id</span>
<span class="devsite-syntax-s2">        FROM Person</span>
<span class="devsite-syntax-s2">        WHERE name = @name</span>
<span class="devsite-syntax-s2">        LIMIT 1 -- Return only the first match in case of duplicate names</span>
<span class="devsite-syntax-s2">    """</span>
    <span class="devsite-syntax-n">params</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">param_types_map</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">STRING</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">fields</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">]</span>

    <span class="devsite-syntax-c1"># Use the standard SQL query helper</span>
    <span class="devsite-syntax-n">results</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">run_sql_query</span><span class="devsite-syntax-p">(</span> <span class="devsite-syntax-n">sql</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">param_types_map</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">expected_fields</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">fields</span><span class="devsite-syntax-p">)</span>

    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">results</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-c1"># Check if the list is not empty</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">results</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s1">'person_id'</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-c1"># Return the ID from the first dictionary</span>
    <span class="devsite-syntax-k">else</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span> <span class="devsite-syntax-c1"># Name not found</span>


<span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_person_posts</span><span class="devsite-syntax-p">(</span> <span class="devsite-syntax-n">person_id</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-nb">dict</span><span class="devsite-syntax-p">]:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">    Fetches posts written by a specific person using Graph Query.</span>

<span class="devsite-syntax-sd">    Args:</span>
<span class="devsite-syntax-sd">        person_id (str): The ID of the person whose posts to fetch.</span>


<span class="devsite-syntax-sd">    Returns:</span>
<span class="devsite-syntax-sd">        list[dict] or None: List of post dictionaries with ISO date strings,</span>
<span class="devsite-syntax-sd">                           or None if an error occurs.</span>
<span class="devsite-syntax-sd">    """</span>
    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-ow">not</span> <span class="devsite-syntax-n">db_instance</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>

    <span class="devsite-syntax-c1"># Graph Query: Find the specific Person node, follow 'Wrote' edge to Post nodes</span>
    <span class="devsite-syntax-n">graph_sql</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">        Graph SocialGraph</span>
<span class="devsite-syntax-s2">        MATCH (author:Person)-[w:Wrote]-&gt;(post:Post)</span>
<span class="devsite-syntax-s2">        WHERE author.person_id = @person_id</span>
<span class="devsite-syntax-s2">        RETURN post.post_id, post.author_id, post.text, post.sentiment, post.post_timestamp, author.name AS author_name</span>
<span class="devsite-syntax-s2">        ORDER BY post.post_timestamp DESC</span>
<span class="devsite-syntax-s2">    """</span>
    <span class="devsite-syntax-c1"># Parameters now include person_id and limit</span>
    <span class="devsite-syntax-n">params</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span>
        <span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">person_id</span>
    <span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">param_types_map</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span>
        <span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">STRING</span>
    <span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-c1"># Fields returned remain the same</span>
    <span class="devsite-syntax-n">fields</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"post_id"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"author_id"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"sentiment"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"post_timestamp"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"author_name"</span><span class="devsite-syntax-p">]</span>

    <span class="devsite-syntax-n">results</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">run_graph_query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">graph_sql</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">param_types_map</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">expected_fields</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">fields</span><span class="devsite-syntax-p">)</span>

    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">results</span> <span class="devsite-syntax-ow">is</span> <span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>

    <span class="devsite-syntax-c1"># Convert datetime objects to ISO format strings</span>
    <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">post</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">results</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-nb">isinstance</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">post</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s1">'post_timestamp'</span><span class="devsite-syntax-p">),</span> <span class="devsite-syntax-n">datetime</span><span class="devsite-syntax-p">):</span>
            <span class="devsite-syntax-n">post</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'post_timestamp'</span><span class="devsite-syntax-p">]</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">post</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'post_timestamp'</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isoformat</span><span class="devsite-syntax-p">()</span>

    <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">results</span>


<span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_person_friends</span><span class="devsite-syntax-p">(</span> <span class="devsite-syntax-n">person_id</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">list</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-nb">dict</span><span class="devsite-syntax-p">]:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">    Fetches friends for a specific person using Graph Query.</span>
<span class="devsite-syntax-sd">    Args:</span>
<span class="devsite-syntax-sd">        person_id (str): The ID of the person whose posts to fetch.</span>
<span class="devsite-syntax-sd">    Returns: list[dict] or None.</span>
<span class="devsite-syntax-sd">    """</span>
    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-ow">not</span> <span class="devsite-syntax-n">db_instance</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>

    <span class="devsite-syntax-n">graph_sql</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">        Graph SocialGraph</span>
<span class="devsite-syntax-s2">        MATCH (p:Person {person_id: @person_id})-[f:Friendship]-(friend:Person)</span>
<span class="devsite-syntax-s2">        RETURN DISTINCT friend.person_id, friend.name</span>
<span class="devsite-syntax-s2">        ORDER BY friend.name</span>
<span class="devsite-syntax-s2">    """</span>
    <span class="devsite-syntax-n">params</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">person_id</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">param_types_map</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">STRING</span><span class="devsite-syntax-p">}</span>
    <span class="devsite-syntax-n">fields</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"person_id"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">]</span>

    <span class="devsite-syntax-n">results</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">run_graph_query</span><span class="devsite-syntax-p">(</span> <span class="devsite-syntax-n">graph_sql</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">param_types</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">param_types_map</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">expected_fields</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">fields</span><span class="devsite-syntax-p">)</span>

    <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">results</span>
</code></pre></devsite-code>
<p>Now, let&#39;s discuss how to structure our agent. Analyzing multiple friends&#39; profiles and then summarizing the findings involves several steps. This is a perfect scenario for using ADK&#39;s multi-agent capabilities, specifically <strong>Workflow Agents</strong>.</p>
<p>In Google&#39;s ADK, a Workflow Agent doesn&#39;t perform tasks itself but orchestrates other agents, called <strong>sub-agents</strong>. This allows for modular design, breaking down complex problems into specialized components. ADK provides built-in workflow types like</p>
<ul>
<li>Sequential (step-by-step)</li>
<li>Parallel (concurrent execution)</li>
<li>and Loop (repeated execution)</li>
</ul>
<p class="image-container"><img alt="Social Profiling Agent" src="/static/instavibe-adk-multi-agents/img/09-agent-02.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-02_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>For our social profiling task, our design uses a Loop Agent to create an iterative workflow. The intention is to process one person at a time: <code translate="no" dir="ltr">profile_agent</code> gathers data, <code translate="no" dir="ltr">summary_agent</code> updates the analysis, and <code translate="no" dir="ltr">check_agent</code> determines if we should loop again.</p>
<p>Let&#39;s define the sub-agents required for this workflow.</p>
<p>üëâüìù In <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE FOR profile_agent</code> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">profile_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">LlmAgent</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"profile_agent"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">model</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"gemini-2.5-flash"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-s2">"Agent to answer questions about the this person social profile. Provide the person's profile using their name, make sure to fetch the id before getting other data."</span>
    <span class="devsite-syntax-p">),</span>
    <span class="devsite-syntax-n">instruction</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-s2">"You are a helpful agent to answer questions about the this person social profile. You'll be given a list of names, provide the person's profile using their name, make sure to fetch the id before getting other data. Get one person at a time, start with the first one on the list, and skip if already provided. return this person's result"</span>
    <span class="devsite-syntax-p">),</span>
    <span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">get_person_posts</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">get_person_friends</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">get_person_id_by_name</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">get_person_attended_events</span><span class="devsite-syntax-p">],</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Next, the agent that takes the collected profile information (accumulated across loop iterations) and generates the final summary, identifying common ground if multiple people were analyzed.</p>
<p>üëâüìù In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE FOR summary_agent</code> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">summary_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">LlmAgent</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"summary_agent"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">model</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"gemini-2.5-flash"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-s2">"Generate a comprehensive social summary as a single, cohesive paragraph. This summary should cover the activities, posts, friend networks, and event participation of one or more individuals. If multiple profiles are analyzed, the paragraph must also identify and integrate any common ground found between them."</span>
    <span class="devsite-syntax-p">),</span>
    <span class="devsite-syntax-n">instruction</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-sd">"""</span>
<span class="devsite-syntax-sd">        Your primary task is to synthesize social profile information into a single, comprehensive paragraph.</span>

<span class="devsite-syntax-sd">            **Input Scope &amp; Default Behavior:**</span>
<span class="devsite-syntax-sd">            *   If specific individuals are named by the user, focus your analysis on them.</span>
<span class="devsite-syntax-sd">            *   **If no individuals are specified, or if the request is general, assume the user wants an analysis of *all relevant profiles available in the current dataset/context*.**</span>

<span class="devsite-syntax-sd">            **For each profile (whether specified or determined by default), you must analyze:**</span>

<span class="devsite-syntax-sd">            1.  **Post Analysis:**</span>
<span class="devsite-syntax-sd">                *   Systematically review their posts (e.g., content, topics, frequency, engagement).</span>
<span class="devsite-syntax-sd">                *   Identify recurring themes, primary interests, and expressed sentiments.</span>

<span class="devsite-syntax-sd">            2.  **Friendship Relationship Analysis:**</span>
<span class="devsite-syntax-sd">                *   Examine their connections/friends list.</span>
<span class="devsite-syntax-sd">                *   Identify key relationships, mutual friends (especially if comparing multiple profiles), and the general structure of their social network.</span>

<span class="devsite-syntax-sd">            3.  **Event Participation Analysis:**</span>
<span class="devsite-syntax-sd">                *   Investigate their past (and if available, upcoming) event participation.</span>
<span class="devsite-syntax-sd">                *   Note the types of events, frequency of attendance, and any notable roles (e.g., organizer, speaker).</span>

<span class="devsite-syntax-sd">            **Output Generation (Single Paragraph):**</span>

<span class="devsite-syntax-sd">            *   **Your entire output must be a single, cohesive summary paragraph.**</span>
<span class="devsite-syntax-sd">                *   **If analyzing a single profile:** This paragraph will detail their activities, interests, and social connections based on the post, friend, and event analysis.</span>
<span class="devsite-syntax-sd">                *   **If analyzing multiple profiles:** This paragraph will synthesize the key findings regarding posts, friends, and events for each individual. Crucially, it must then seamlessly integrate or conclude with an identification and description of the common ground found between them (e.g., shared interests from posts, overlapping event attendance, mutual friends). The aim is a unified narrative within this single paragraph.</span>

<span class="devsite-syntax-sd">            **Key Considerations:**</span>
<span class="devsite-syntax-sd">            *   Base your summary strictly on the available data.</span>
<span class="devsite-syntax-sd">            *   If data for a specific category (posts, friends, events) is missing or sparse for a profile, you may briefly acknowledge this within the narrative if relevant.</span>
<span class="devsite-syntax-sd">                """</span>
        <span class="devsite-syntax-p">),</span>
    <span class="devsite-syntax-n">output_key</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"summary"</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>We need a way to determine when the loop should stop (i.e., when all requested profiles have been summarized)</p>
<p>üëâüìù In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE FOR check_agent</code> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">check_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">LlmAgent</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"check_agent"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">model</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"gemini-2.5-flash"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-s2">"Check if everyone's social profile are summarized and has been generated. Output 'completed' or 'pending'."</span>
    <span class="devsite-syntax-p">),</span>
    <span class="devsite-syntax-n">output_key</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"summary_status"</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>We add a simple programmatic check (CheckCondition) that explicitly looks at the <code translate="no" dir="ltr">summary_status</code> stored in the <strong>State</strong>, that are returned by <code translate="no" dir="ltr">check_agent</code> and tells the Loop Agent whether to continue (escalate=False) or stop (escalate=True).</p>
<p>üëâüìù In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE FOR CheckCondition</code> located on the top of the file with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">CheckCondition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">BaseAgent</span><span class="devsite-syntax-p">):</span>
    <span class="devsite-syntax-k">async</span> <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">_run_async_impl</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">ctx</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">InvocationContext</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-n">AsyncGenerator</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">Event</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">]:</span>
        <span class="devsite-syntax-c1">#log.info(f"Checking status: {ctx.session.state.get("summary_status", "fail")}")</span>
        <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">info</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Summary: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">ctx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">session</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"summary"</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">status</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">ctx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">session</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"summary_status"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"fail"</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">strip</span><span class="devsite-syntax-p">()</span>
        <span class="devsite-syntax-n">is_done</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">status</span> <span class="devsite-syntax-o">==</span> <span class="devsite-syntax-s2">"completed"</span><span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-k">yield</span> <span class="devsite-syntax-n">Event</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">author</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">actions</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">EventActions</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">escalate</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">is_done</span><span class="devsite-syntax-p">))</span>
</code></pre></devsite-code>
<p><strong>State and Callbacks for Loop Results</strong></p>
<p>In Google&#39;s ADK, <strong>State</strong> is a crucial concept representing the memory or working data of an agent during its execution. It&#39;s essentially a persistent context that holds information an agent needs to maintain across different steps, tool calls, or interactions. This state can store intermediate results, user information, parameters for subsequent actions, or any other data the agent needs to remember as it progresses through a task.</p>
<p>In our scenario, as the Loop Agent iterates, the <code translate="no" dir="ltr">summary_agent</code> and <code translate="no" dir="ltr">check_agent</code> store their outputs (summary and summary_status) in the agent&#39;s State. This allows information to persist across iterations. However, the Loop Agent itself doesn&#39;t automatically return the final summary from the state when it finishes.</p>
<p class="image-container"><img alt="Social Profiling Agent" src="/static/instavibe-adk-multi-agents/img/09-agent-03.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-agent-03_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p><strong>Callbacks</strong> in ADK allow us to inject custom logic to be executed at specific points during an agent&#39;s lifecycle or in response to certain events, such as the completion of a tool call or before the agent finishes its execution. They provide a way to customize the agent&#39;s behavior and process results dynamically.</p>
<p>We&#39;ll use an <code translate="no" dir="ltr">after_agent_callback</code> that runs when the loop finishes (because CheckCondition escalated). This callback <code translate="no" dir="ltr">modify_output_after_agent</code> retrieves the final summary from the state and formats it as the agent&#39;s final output message.</p>
<p class="image-container"><img alt="Call back" src="/static/instavibe-adk-multi-agents/img/callback.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/callback_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüìù In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE FOR modify_output_after_agent</code> with follow:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">modify_output_after_agent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">callback_context</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">CallbackContext</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-n">Optional</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Content</span><span class="devsite-syntax-p">]:</span>

    <span class="devsite-syntax-n">agent_name</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">callback_context</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_name</span>
    <span class="devsite-syntax-n">invocation_id</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">callback_context</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">invocation_id</span>
    <span class="devsite-syntax-n">current_state</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">callback_context</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">to_dict</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-n">current_user_content</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">callback_context</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">user_content</span>
    <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"[Callback] Exiting agent: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">agent_name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> (Inv: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">invocation_id</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">)"</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"[Callback] Current summary_status: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">current_state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"summary_status"</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"[Callback] Current Content: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">current_user_content</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>

    <span class="devsite-syntax-n">status</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">current_state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"summary_status"</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">strip</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-n">is_done</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">status</span> <span class="devsite-syntax-o">==</span> <span class="devsite-syntax-s2">"completed"</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-c1"># Retrieve the final summary from the state</span>

    <span class="devsite-syntax-n">final_summary</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">current_state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"summary"</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"[Callback] final_summary: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">final_summary</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">final_summary</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">is_done</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-nb">isinstance</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">final_summary</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">):</span>
        <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">info</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"[Callback] Found final summary, constructing output Content."</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-c1"># Construct the final output Content object to be sent back</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Content</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"model"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">parts</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">types</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Part</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">final_summary</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">strip</span><span class="devsite-syntax-p">())])</span>
    <span class="devsite-syntax-k">else</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">warning</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"[Callback] No final summary found in state or it's not a string."</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-c1"># Optionally return a default message or None if no summary was generated</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-kc">None</span>
</code></pre></devsite-code>
<p><strong>Defining the Root Loop Agent</strong></p>
<p>Finally, we define the main LoopAgent. It orchestrates the sub-agents in sequence within each loop iteration (profile_agent -&gt; summary_agent -&gt; check_agent -&gt; CheckCondition). It will repeat this sequence up to max_iterations times or until CheckCondition signals completion. The after_agent_callback ensures the final summary is returned.</p>
<p>üëâüìù In the same <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE FOR root_agent</code> with follow:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">root_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">LoopAgent</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"InteractivePipeline"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">sub_agents</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span>
        <span class="devsite-syntax-n">profile_agent</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">summary_agent</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">check_agent</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">CheckCondition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Checker"</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-p">],</span>
    <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Find everyone's social profile on events, post and friends"</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">max_iterations</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">10</span><span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">after_agent_callback</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">modify_output_after_agent</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Let&#39;s test this multi-agent workflow using the ADK Dev UI.</p>
<p>üëâüíª Launch the ADK web server:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">cd</span>  <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">sed</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">i</span> <span class="devsite-syntax-s2">"s|^\(O\?GOOGLE_CLOUD_PROJECT\)=.*|GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">|"</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">social</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">env</span>
<span class="devsite-syntax-n">adk</span> <span class="devsite-syntax-n">web</span>
</code></pre></devsite-code>
<p>Open the ADK Dev UI (port 8000 via Web Preview). In the agent dropdown menu (top-right), select the <strong>Social</strong> Agent.</p>
<p>üëâ Now, give it the task to profile multiple people. In the chat dialog, enter:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">Tell</span> <span class="devsite-syntax-n">me</span> <span class="devsite-syntax-n">about</span> <span class="devsite-syntax-n">Mike</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">Bob</span>
</code></pre></devsite-code>
<p>After the agent responds (which might take a bit longer due to the looping and multiple LLM calls), don&#39;t just look at the final chat output. Navigate to the Events tab in the left-hand pane of the ADK Dev UI.</p>
<p>üëâ Verification Step: In the Events tab, you will see a detailed, step-by-step trace of the execution. <img alt="09-01-adk-dev-ui.png" src="/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-01-adk-dev-ui_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>After observing how the agent invokes each sub-agent, where you expect the flow to go from profile_agent -&gt; summary_agent -&gt; check_agent, Checker within each iteration. But in practice, however, we see the agent&#39;s powerful ‚Äòself-optimization&#39; in action.</p>
<p>Because the underlying model sees the entire request (e.g., ‚Äòprofile Mike and Bob&#39;), it often chooses the most efficient path, gathering all required data in a single, consolidated turn rather than iterating multiple times. You can see the inputs and outputs and states for each step, including tool calls made by profile_agent</p>
<p class="image-container"><img alt="09-02-ui-graph.png" src="/static/instavibe-adk-multi-agents/img/09-02-ui-graph.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-02-ui-graph_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>and the status updates from check_agent and CheckCondition. <img alt="09-03-ui-state.png" src="/static/instavibe-adk-multi-agents/img/09-03-ui-state.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/09-03-ui-state_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>This visual trace is invaluable for understanding and debugging how the multi-agent workflow operates until the final summary is generated and returned by the callback.</p>
<p>Once you have explored the chat response and the event trace, return to the Cloud Shell terminal and press <code translate="no" dir="ltr">Ctrl+C</code> to stop the ADK Dev UI.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Agent-to-Agent (A2A) Communication" duration="0" step="9">
          
          <h2 class="step-title" id="9" data-text="Agent-to-Agent (A2A) Communication" tabindex="-1">
              10. Agent-to-Agent (A2A) Communication
          </h2>
          <p>So far, we&#39;ve built specialized agents, but they operate in isolation or within a predefined workflow on the same machine. To build truly distributed and collaborative multi-agent systems, we need a way for agents, potentially running as separate services, to discover each other and communicate effectively. This is where the Agent-to-Agent (A2A) protocol comes in.</p>
<p>The A2A protocol is an open standard specifically designed for interoperable communication between AI agents. While MCP focuses on agent-to-tool interaction, A2A focuses on agent-to-agent interaction. It allows agents to:</p>
<ul>
<li><strong>Discover</strong>: Find other agents and learn their capabilities via standardized Agent Cards.</li>
<li><strong>Communicate</strong>: Exchange messages and data securely.</li>
<li><strong>Collaborate</strong>: Delegate tasks and coordinate actions to achieve complex goals.</li>
</ul>
<p>The A2A protocol facilitates this communication through mechanisms like &#34;Agent Cards,&#34; which agents can use to advertise their capabilities and connection information.</p>
<p class="image-container"><img alt="10-05-agent-card" src="/static/instavibe-adk-multi-agents/img/10-05-agent-card.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-05-agent-card_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>A2A utilizes familiar web standards (HTTP, SSE, JSON-RPC) and often employs a client-server model where one agent (client) sends tasks to another (remote agent/server). This standardization is key to building modular, scalable systems where agents developed independently can work together.</p>
<h2 is-upgraded id="enabling-a2a-for-instavibe-agents" data-text="Enabling A2A for InstaVibe Agents" tabindex="-1">Enabling A2A for InstaVibe Agents</h2>
<p>To make our existing Planner, Platform Interaction, and Social agents accessible to other agents via A2A, we need to wrap each one with an A2A Server component. This server will:</p>
<ul>
<li><strong>Expose an Agent Card</strong>: Serve a standard description of the agent&#39;s capabilities via an HTTP endpoint.</li>
<li><strong>Listen for Tasks(Request Messages)</strong>: Accept incoming task requests from other agents (A2A clients) according to the A2A protocol.</li>
<li><strong>Manage Task(Request Messages) Execution</strong>: Hand off received tasks to the underlying ADK agent logic for processing.</li>
</ul>
<h2 is-upgraded id="planner-agent-a2a-enabled" data-text="Planner Agent (A2A Enabled)" tabindex="-1">Planner Agent (A2A Enabled)</h2>
<p class="image-container"><img alt="all-agent-planner" src="/static/instavibe-adk-multi-agents/img/all-agent-planner.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-planner_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Let&#39;s start by adding the A2A server layer to our Planner Agent.</p>
<p>Define the A2A server startup logic. This code defines the AgentCard (the public description of the agent), configures the A2AServer, and starts it, linking it to the <strong>PlatformAgentExecutor</strong>.</p>
<p>üëâüìù Add the following code to the end of <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/planner/a2a_server.py</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">PlannerAgent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""An agent to help user planning a event with its desire location."""</span>
    <span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"text/plain"</span><span class="devsite-syntax-p">]</span>

    <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-fm">__init__</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">):</span>
        <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_build_agent</span><span class="devsite-syntax-p">()</span>
        <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">runner</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">Runner</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">app_name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">artifact_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryArtifactService</span><span class="devsite-syntax-p">(),</span>
            <span class="devsite-syntax-n">session_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemorySessionService</span><span class="devsite-syntax-p">(),</span>
            <span class="devsite-syntax-n">memory_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryMemoryService</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">capabilities</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentCapabilities</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">streaming</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">True</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">skill</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentSkill</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-nb">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"event_planner"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Event planner"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">            This agent generates multiple fun plan suggestions tailored to your specified location, dates, and interests,</span>
<span class="devsite-syntax-s2">            all designed for a moderate budget. It delivers detailed itineraries,</span>
<span class="devsite-syntax-s2">            including precise venue information (name, latitude, longitude, and description), in a structured JSON format.</span>
<span class="devsite-syntax-s2">            """</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">tags</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"instavibe"</span><span class="devsite-syntax-p">],</span>
            <span class="devsite-syntax-n">examples</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"What about Bostona MA this weekend?"</span><span class="devsite-syntax-p">],</span>
        <span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentCard</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Event Planner Agent"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">            This agent generates multiple fun plan suggestions tailored to your specified location, dates, and interests,</span>
<span class="devsite-syntax-s2">            all designed for a moderate budget. It delivers detailed itineraries,</span>
<span class="devsite-syntax-s2">            including precise venue information (name, latitude, longitude, and description), in a structured JSON format.</span>
<span class="devsite-syntax-s2">            """</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">url</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">PUBLIC_URL</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">version</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"1.0.0"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">defaultInputModes</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">PlannerAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">defaultOutputModes</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">PlannerAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">capabilities</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">capabilities</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">skills</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">skill</span><span class="devsite-syntax-p">],</span>
        <span class="devsite-syntax-p">)</span>

    <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_processing_message</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-s2">"Processing the planning request..."</span>

    <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">_build_agent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-n">LlmAgent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-sd">"""Builds the LLM agent for the night out planning agent."""</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">root_agent</span>


<span class="devsite-syntax-k">if</span> <span class="devsite-syntax-vm">__name__</span> <span class="devsite-syntax-o">==</span> <span class="devsite-syntax-s1">'__main__'</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">plannerAgent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">PlannerAgent</span><span class="devsite-syntax-p">()</span>

        <span class="devsite-syntax-n">request_handler</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">DefaultRequestHandler</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">agent_executor</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">PlannerAgentExecutor</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">plannerAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">runner</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">plannerAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-p">),</span>
            <span class="devsite-syntax-n">task_store</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryTaskStore</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">server</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">A2AStarletteApplication</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">plannerAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">http_handler</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">request_handler</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">logger</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">info</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Attempting to start server with Agent Card: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">plannerAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">logger</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">info</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"Server object created: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">uvicorn</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">run</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">build</span><span class="devsite-syntax-p">(),</span> <span class="devsite-syntax-n">host</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'0.0.0.0'</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">port</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">port</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-ne">Exception</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">logger</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"An error occurred during server startup: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">exit</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>üëâüíª Let&#39;s quickly test if the A2A server starts correctly locally and serves its Agent Card. Run the following command in your first terminal:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-n">python</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">m</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">a2a_server</span>
</code></pre></devsite-code>
<p>üëâ Now, open another terminal window. (Click on the + sign in the terminal panel) <img alt="two terminals" src="/static/instavibe-adk-multi-agents/img/10-01-two-terminals.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-01-two-terminals_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüíª Use curl to request the Agent Card from the locally running server:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-curl" class="language-curl" translate="no" dir="ltr"><span class="devsite-syntax-n">curl</span> <span class="devsite-syntax-n">http</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-n">localhost</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-mi">10003</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">well</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">known</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">json</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">jq</span>
</code></pre></devsite-code>
<p>You should see the JSON representation of the AgentCard we defined, confirming the server is running and advertising the Planner agent.</p>
<p class="image-container"><img alt="10-02-planner-a2a.png" src="/static/instavibe-adk-multi-agents/img/10-02-planner-a2a.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-02-planner-a2a_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Go back to the first terminal (where the server is running) and press <code translate="no" dir="ltr">Ctrl+C</code> to stop it.</p>
<p>üëâüíª With the A2A server logic added, we can now build the container image.</p>
<h3 is-upgraded id="build-and-deploy-the-planner-agent" data-text="Build and Deploy the Planner Agent" tabindex="-1">Build and Deploy the Planner Agent</h3>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>

<span class="devsite-syntax-c1"># Set variables specific to the PLANNER agent</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">AGENT_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner-agent"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner-agent"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PUBLIC_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"https://planner-agent-$</span><span class="devsite-syntax-si">{PROJECT_NUMBER}</span><span class="devsite-syntax-s2">.$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">.run.app"</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Building $</span><span class="devsite-syntax-si">{AGENT_NAME}</span><span class="devsite-syntax-s2"> agent..."</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">builds</span> <span class="devsite-syntax-n">submit</span> <span class="devsite-syntax-o">.</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">config</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">cloudbuild</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">build</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">yaml</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">substitutions</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">_AGENT_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">AGENT_NAME</span><span class="devsite-syntax-p">},</span><span class="devsite-syntax-n">_IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Image built and pushed to: $</span><span class="devsite-syntax-si">{IMAGE_PATH}</span><span class="devsite-syntax-s2">"</span>
</code></pre></devsite-code>
<p>üëâüíª And deploy our Planner Agent on Cloud Run.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>

<span class="devsite-syntax-c1"># Set variables specific to the PLANNER agent</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">AGENT_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner-agent"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"planner-agent"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PUBLIC_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"https://planner-agent-$</span><span class="devsite-syntax-si">{PROJECT_NUMBER}</span><span class="devsite-syntax-s2">.$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">.run.app"</span>


<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">deploy</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">image</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"A2A_HOST=0.0.0.0"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"A2A_PORT=8080"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_GENAI_USE_VERTEXAI=TRUE"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_LOCATION=$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"PUBLIC_URL=$</span><span class="devsite-syntax-si">{PUBLIC_URL}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">allow</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">unauthenticated</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">min</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">instances</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">1</span>

</code></pre></devsite-code>
<p>Let&#39;s verify that the deployed service is running and serving its Agent Card correctly from the cloud using the <strong>A2A Inspector</strong>.</p>
<p>üëâ From the Web preview icon in the Cloud Shell toolbar, select Change port. <strong>Set the port to 8081</strong> and click &#34;Change and Preview&#34;. A new browser tab will open with the A2A Inspector interface.</p>
<p class="image-container"><img alt="10-08-web-preview.png" src="/static/instavibe-adk-multi-agents/img/10-08-web-preview.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâüíª In the terminal, get the URL of your deployed planner agent:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PLANNER_AGENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PLANNER_AGENT_URL</span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>üëâüíª Copy the output URL.</p>
<p>üëâ In the A2A Inspector UI, paste the URL into the Agent URL field and click Connect.</p>
<p>üëÄ The agent&#39;s card details and JSON should appear on the Agent Card tab, confirming a successful connection.</p>
<p class="image-container"><img alt="10-03-planner-a2a.png" src="/static/instavibe-adk-multi-agents/img/10-03-planner-a2a.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-planner-a2a_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Click on the Chat tab in the A2A Inspector. This is where you can interact directly with your deployed agen, Send it a message to test its planning capability. For example:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">Plan</span> <span class="devsite-syntax-n">something</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">me</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">Boston</span> <span class="devsite-syntax-n">MA</span> <span class="devsite-syntax-n">this</span> <span class="devsite-syntax-n">weekend</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">I</span> <span class="devsite-syntax-n">enjoy</span> <span class="devsite-syntax-n">classical</span> <span class="devsite-syntax-n">music</span>
</code></pre></devsite-code>
<p>üëÄ To inspect the raw communication, click on your message bubble and then on the agent&#39;s response bubble in the chat window. As you click each one, it will display the full JSON-RPC 2.0 message that was sent or received, which is invaluable for debugging.</p>
<p>Let&#39;s keep the A2A Inspector tab handy. Do NOT close it! We&#39;ll be using it again in a moment to test our other two agents.</p>
<p class="image-container"><img alt="10-06-a2a-inspector.png" src="/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-06-a2a-inspector_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<h2 is-upgraded id="platform-interaction-agent-a2a-enabled" data-text="Platform Interaction Agent (A2A Enabled)" tabindex="-1">Platform Interaction Agent (A2A Enabled)</h2>
<p class="image-container"><img alt="all-agent-platform" src="/static/instavibe-adk-multi-agents/img/all-agent-platform.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-platform_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Next, we&#39;ll repeat the process for the Platform Interaction Agent (the one using MCP).</p>
<p>üëâüìù Define the A2A server setup, including its unique AgentCard, at the end of <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/platform_mcp_client/a2a_server.py</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">PlatformAgent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-sd">"""An agent that post event and post to instavibe."""</span>

  <span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"text/plain"</span><span class="devsite-syntax-p">]</span>

  <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-fm">__init__</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">):</span>
    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_build_agent</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">runner</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">Runner</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-n">app_name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">artifact_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryArtifactService</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-n">session_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemorySessionService</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-n">memory_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryMemoryService</span><span class="devsite-syntax-p">(),</span>
    <span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-n">capabilities</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentCapabilities</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">streaming</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">True</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-n">skill</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentSkill</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-nb">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe_posting"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Post social post and events on instavibe"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">            This "Instavibe" agent helps you create posts (identifying author, text, and sentiment ‚Äì inferred if unspecified) and register</span>
<span class="devsite-syntax-s2">            for events (gathering name, date, attendee). It efficiently collects required information and utilizes dedicated tools</span>
<span class="devsite-syntax-s2">            to perform these actions on your behalf, ensuring a smooth sharing experience.</span>
<span class="devsite-syntax-s2">            """</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">tags</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"instavibe"</span><span class="devsite-syntax-p">],</span>
            <span class="devsite-syntax-n">examples</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"Create a post for me, the post is about my cute cat and make it positive, and I'm Alice"</span><span class="devsite-syntax-p">],</span>
        <span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentCard</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Instavibe Posting Agent"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">            This "Instavibe" agent helps you create posts (identifying author, text, and sentiment ‚Äì inferred if unspecified) and register</span>
<span class="devsite-syntax-s2">            for events (gathering name, date, attendee). It efficiently collects required information and utilizes dedicated tools</span>
<span class="devsite-syntax-s2">            to perform these actions on your behalf, ensuring a smooth sharing experience.</span>
<span class="devsite-syntax-s2">            """</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">url</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">PUBLIC_URL</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">version</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"1.0.0"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">defaultInputModes</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">PlatformAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">defaultOutputModes</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">PlatformAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">capabilities</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">capabilities</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">skills</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">skill</span><span class="devsite-syntax-p">],</span>
        <span class="devsite-syntax-p">)</span>


  <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_processing_message</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">:</span>
      <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-s2">"Processing the social post and event request..."</span>

  <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">_build_agent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-n">LlmAgent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""Builds the LLM agent for the Processing the social post and event request."""</span>
    <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">root_agent</span>


<span class="devsite-syntax-k">if</span> <span class="devsite-syntax-vm">__name__</span> <span class="devsite-syntax-o">==</span> <span class="devsite-syntax-s1">'__main__'</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">platformAgent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">PlatformAgent</span><span class="devsite-syntax-p">()</span>

        <span class="devsite-syntax-n">request_handler</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">DefaultRequestHandler</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">agent_executor</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">PlatformAgentExecutor</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">platformAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">runner</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">platformAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-p">),</span>
            <span class="devsite-syntax-n">task_store</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryTaskStore</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">server</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">A2AStarletteApplication</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">platformAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">http_handler</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">request_handler</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">uvicorn</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">run</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">build</span><span class="devsite-syntax-p">(),</span> <span class="devsite-syntax-n">host</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'0.0.0.0'</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">port</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">port</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-ne">Exception</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">logger</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"An error occurred during server startup: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">exit</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<h2 is-upgraded id="social-agent-a2a-enabled" data-text="Social Agent (A2A Enabled)" tabindex="-1">Social Agent (A2A Enabled)</h2>
<p class="image-container"><img alt="all-agent-social" src="/static/instavibe-adk-multi-agents/img/all-agent-social.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-social_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Finally, let&#39;s enable A2A for our Social Profiling Agent.</p>
<p>üëâüìù Define the A2A server setup and AgentCard at the end of <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/social/a2a_server.py</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">SocialAgent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-sd">"""An agent that handles social profile analysis."""</span>

  <span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"text"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"text/plain"</span><span class="devsite-syntax-p">]</span>

  <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-fm">__init__</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">):</span>
    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_build_agent</span><span class="devsite-syntax-p">()</span>
    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">runner</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">Runner</span><span class="devsite-syntax-p">(</span>
        <span class="devsite-syntax-n">app_name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">_agent</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-n">artifact_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryArtifactService</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-n">session_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemorySessionService</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-n">memory_service</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryMemoryService</span><span class="devsite-syntax-p">(),</span>
    <span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-n">capabilities</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentCapabilities</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">streaming</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">True</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-n">skill</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentSkill</span><span class="devsite-syntax-p">(</span>
                <span class="devsite-syntax-nb">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"social_profile_analysis"</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Analyze Instavibe social profile"</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">                Using a provided list of names, this agent synthesizes Instavibe social profile information by analyzing posts, friends, and events.</span>
<span class="devsite-syntax-s2">                It delivers a comprehensive single-paragraph summary for individuals, and for groups, identifies commonalities in their social activities</span>
<span class="devsite-syntax-s2">                and connections based on profile data.</span>
<span class="devsite-syntax-s2">                """</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">tags</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"instavibe"</span><span class="devsite-syntax-p">],</span>
                <span class="devsite-syntax-n">examples</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"Can you tell me about Bob and Alice?"</span><span class="devsite-syntax-p">],</span>
    <span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">AgentCard</span><span class="devsite-syntax-p">(</span>
                <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Social Profile Agent"</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">                Using a provided list of names, this agent synthesizes Instavibe social profile information by analyzing posts, friends, and events.</span>
<span class="devsite-syntax-s2">                It delivers a comprehensive single-paragraph summary for individuals, and for groups, identifies commonalities in their social activities</span>
<span class="devsite-syntax-s2">                and connections based on profile data.</span>
<span class="devsite-syntax-s2">                """</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">url</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">PUBLIC_URL</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">version</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"1.0.0"</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">defaultInputModes</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">defaultOutputModes</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SUPPORTED_CONTENT_TYPES</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">capabilities</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">capabilities</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">skills</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">skill</span><span class="devsite-syntax-p">],</span>
    <span class="devsite-syntax-p">)</span>

  <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">get_processing_message</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">:</span>
      <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-s2">"Processing the social profile analysis request..."</span>

  <span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">_build_agent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-n">LoopAgent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-sd">"""Builds the LLM agent for the social profile analysis agent."""</span>
    <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">root_agent</span>

<span class="devsite-syntax-k">if</span> <span class="devsite-syntax-vm">__name__</span> <span class="devsite-syntax-o">==</span> <span class="devsite-syntax-s1">'__main__'</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">socialAgent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">SocialAgent</span><span class="devsite-syntax-p">()</span>

        <span class="devsite-syntax-n">request_handler</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">DefaultRequestHandler</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">agent_executor</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">SocialAgentExecutor</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">socialAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">runner</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-n">socialAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-p">),</span>
            <span class="devsite-syntax-n">task_store</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">InMemoryTaskStore</span><span class="devsite-syntax-p">(),</span>
        <span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">server</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">A2AStarletteApplication</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">socialAgent</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">http_handler</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">request_handler</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-p">)</span>

        <span class="devsite-syntax-n">uvicorn</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">run</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">build</span><span class="devsite-syntax-p">(),</span> <span class="devsite-syntax-n">host</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'0.0.0.0'</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">port</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">port</span><span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-ne">Exception</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">logger</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"An error occurred during server startup: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-n">exit</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<h3 is-upgraded id="build-and-deploy-the-platform-interaction-and-social-agents" data-text="Build and Deploy the Platform Interaction and Social agents" tabindex="-1">Build and Deploy the Platform Interaction and Social agents</h3>
<p>These agents need access to Spanner, so ensure the <code translate="no" dir="ltr">SPANNER_INSTANCE_ID</code>, <code translate="no" dir="ltr">SPANNER_DATABASE_ID</code> and <code translate="no" dir="ltr">MCP_SERVER_URL</code> environment variables are correctly passed during deployment.</p>
<p>üëâüíª Build and deploy to Cloud Run with <em>Cloud Build</em>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">MCP_SERVER_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">tool</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">server</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">sse</span>


<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">builds</span> <span class="devsite-syntax-n">submit</span> <span class="devsite-syntax-o">.</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">config</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">cloudbuild</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">yaml</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">substitutions</span><span class="devsite-syntax-o">=</span>\
<span class="devsite-syntax-n">_PROJECT_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>\
<span class="devsite-syntax-n">_PROJECT_NUMBER</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{PROJECT_NUMBER}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>\
<span class="devsite-syntax-n">_REGION</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>\
<span class="devsite-syntax-n">_REPO_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>\
<span class="devsite-syntax-n">_SPANNER_INSTANCE_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{SPANNER_INSTANCE_ID}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>\
<span class="devsite-syntax-n">_SPANNER_DATABASE_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{SPANNER_DATABASE_ID}</span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-p">,</span>\
<span class="devsite-syntax-n">_MCP_SERVER_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{MCP_SERVER_URL}</span><span class="devsite-syntax-s2">"</span>
</code></pre></devsite-code>
<p>üëâüíª In the terminal, get the URL of your deployed platform agent:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PLATFORM_MPC_CLIENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">client</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PLATFORM_MPC_CLIENT_URL</span>
</code></pre></devsite-code>
<p>üëâüíª Copy the output URL.</p>
<p>üëâ In the A2A Inspector UI, paste the URL into the Agent URL field and click Connect.</p>
<p>üëÄ The agent&#39;s card details and JSON should appear on the Agent Card tab, confirming a successful connection.</p>
<p class="image-container"><img alt="10-05-platform-a2a.png" src="/static/instavibe-adk-multi-agents/img/10-03-platform-a2a.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-03-platform-a2a_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Click on the Chat tab in the A2A Inspector. This is where you can interact directly with your deployed agen, Send it a message test the agent&#39;s ability to create posts:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-txt" class="language-txt" translate="no" dir="ltr"><span class="devsite-syntax-n">Create</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">post</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">me</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">post</span> <span class="devsite-syntax-n">says</span> <span class="devsite-syntax-s1">'Paws, purrs, and ocean views üêæ‚òïüåä. Spent my morning at the Morning Seaside Cat Caf√©, where every sip comes with a side of snuggles and sea breeze.'</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">make</span> <span class="devsite-syntax-n">it</span> <span class="devsite-syntax-n">positive</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">I</span><span class="devsite-syntax-s1">'m Oscar.</span>
</code></pre></devsite-code>
<p>üëÄ To inspect the raw communication, click on your message bubble and then on the agent&#39;s response bubble in the chat window. As you click each one, it will display the full JSON-RPC 2.0 message that was sent or received, which is invaluable for debugging.</p>
<p>üëâüíª In the terminal, get the URL of your deployed Social agent:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SOCIAL_AGENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">social</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">SOCIAL_AGENT_URL</span>
</code></pre></devsite-code>
<p>üëâüíª Copy the output URL.</p>
<p>üëâ In the A2A Inspector UI, paste the URL into the Agent URL field and click Connect.</p>
<p>üëÄ The agent&#39;s card details and JSON should appear on the Agent Card tab, confirming a successful connection.</p>
<p class="image-container"><img alt="10-04-social-a2a.png" src="/static/instavibe-adk-multi-agents/img/10-04-social-a2a.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-04-social-a2a_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Click on the Chat tab in the A2A Inspector. This is where you can interact directly with your deployed agen, Send it a message to analyze user profiles from your database:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">Can</span> <span class="devsite-syntax-n">you</span> <span class="devsite-syntax-n">tell</span> <span class="devsite-syntax-n">me</span> <span class="devsite-syntax-n">about</span> <span class="devsite-syntax-n">both</span> <span class="devsite-syntax-n">Ian</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">Kevin</span><span class="devsite-syntax-s1">'s profile, what are their common interests?</span>
</code></pre></devsite-code>
<p>üëÄ To inspect the raw communication, click on your message bubble and then on the agent&#39;s response bubble in the chat window. As you click each one, it will display the full JSON-RPC 2.0 message that was sent or received, which is invaluable for debugging.</p>
<p>üëâ  Great, we&#39;ve finished inspecting all our agents. You can close the A2A Inspector tab now.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Orchestrator Agent (A2A Client)" duration="0" step="10">
          
          <h2 class="step-title" id="10" data-text="Orchestrator Agent (A2A Client)" tabindex="-1">
              11. Orchestrator Agent (A2A Client)
          </h2>
          <p>We now have three specialized agents (Planner, Platform, Social) running as independent, A2A-enabled services on Cloud Run. The final piece is the Orchestrator Agent. This agent will act as the central coordinator or A2A Client. It will receive user requests, figure out which remote agent(s) are needed to fulfill the request (potentially in sequence), and then use the A2A protocol to delegate tasks to those remote agents. For this workshop, we will run the Orchestrator agent locally using the ADK Dev UI.</p>
<p class="image-container"><img alt="all-agent-orchestrator" src="/static/instavibe-adk-multi-agents/img/all-agent-orchestrate.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/all-agent-orchestrate_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>First, let&#39;s enhance the Orchestrator&#39;s logic to handle the registration of remote agents it discovers. Stores the connection details from the fetched Agent Cards during initialization.</p>
<p>üëâüìù In <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/orchestrate/agent.py</code>, replace <code translate="no" dir="ltr">#REPLACE ME REG AGENT CARD</code> with:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">async</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">httpx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">AsyncClient</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">timeout</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">30</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">client</span><span class="devsite-syntax-p">:</span>
            <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">address</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-nb">enumerate</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">REMOTE_AGENT_ADDRESSES</span><span class="devsite-syntax-p">):</span>
                <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">info</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"--- STEP 3.</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">: Attempting connection to: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">address</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> ---"</span><span class="devsite-syntax-p">)</span>
                <span class="devsite-syntax-k">try</span><span class="devsite-syntax-p">:</span>
                    <span class="devsite-syntax-n">card_resolver</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">A2ACardResolver</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">client</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">address</span><span class="devsite-syntax-p">)</span>
                    <span class="devsite-syntax-n">card</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-k">await</span> <span class="devsite-syntax-n">card_resolver</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get_agent_card</span><span class="devsite-syntax-p">()</span>
                    
                    <span class="devsite-syntax-n">remote_connection</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">RemoteAgentConnections</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">agent_card</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">card</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">agent_url</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">address</span><span class="devsite-syntax-p">)</span>
                    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">remote_agent_connections</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">card</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">]</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">remote_connection</span>
                    <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">cards</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">card</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">]</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">card</span>
                    <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">info</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"--- STEP 5.</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">: Successfully stored connection for </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">card</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">name</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> ---"</span><span class="devsite-syntax-p">)</span>

                <span class="devsite-syntax-k">except</span> <span class="devsite-syntax-ne">Exception</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">:</span>
                    <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"--- CRITICAL FAILURE at STEP 4.</span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> for address: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">address</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> ---"</span><span class="devsite-syntax-p">)</span>
                    <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"--- The hidden exception type is: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-nb">type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-vm">__name__</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2"> ---"</span><span class="devsite-syntax-p">)</span>
                    <span class="devsite-syntax-n">log</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"--- Full exception details and traceback: ---"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">exc_info</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">True</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Next, define the tool for the Orchestrator agent itself within ADK.</p>
<ul>
<li><code translate="no" dir="ltr">send_message</code> (the A2A function to delegate work).</li>
</ul>
<p>üëâüìù Replace <code translate="no" dir="ltr">#REPLACE ME CREATE AGENT</code> in <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/orchestrate/agent.py</code> with:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">create_agent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-n">Agent</span><span class="devsite-syntax-p">:</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-sd">"""Synchronously creates the ADK Agent object."""</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-n">Agent</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">model</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"gemini-2.5-flash"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"orchestrate_agent"</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">instruction</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">root_instruction</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">before_agent_callback</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">before_agent_callback</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">description</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"Orchestrates tasks for child agents."</span><span class="devsite-syntax-p">),</span>
            <span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">send_message</span><span class="devsite-syntax-p">],</span> 
        <span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>The core logic of the Orchestrator lies in its instructions, which tell it how to use A2A.</p>
<p>üëâüìù Replace <code translate="no" dir="ltr">#REPLACE ME INSTRUCTIONS</code> in <code translate="no" dir="ltr">~/instavibe-bootstrap/agents/orchestrate/agent.py</code> with this instruction-generating method:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-k">def</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">root_instruction</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">ReadonlyContext</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-o">-</span>&gt; <span class="devsite-syntax-nb">str</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-n">current_agent</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">check_active_agent</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span>
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-sa">f</span><span class="devsite-syntax-s2">"""</span>
<span class="devsite-syntax-s2">                You are an expert AI Orchestrator. Your primary responsibility is to intelligently interpret user requests, break them down into a logical plan of discrete actions, and delegate each action to the most appropriate specialized remote agent using the send_message function. You do not perform the tasks yourself but manage their assignment, sequence, and critically, their outcomes.</span>
<span class="devsite-syntax-s2">                    **Core Directives &amp; Decision Making:**</span>

<span class="devsite-syntax-s2">                    *   **Understand User Intent &amp; Complexity:**</span>
<span class="devsite-syntax-s2">                        *   Carefully analyze the user's request to determine the core task(s) they want to achieve. Pay close attention to keywords and the overall goal.</span>
<span class="devsite-syntax-s2">                        *   Identify if the request requires a single agent or a sequence of actions from multiple agents. For example, "Analyze John Doe's profile and then create a positive post about his recent event attendance" would require two agents in sequence.</span>

<span class="devsite-syntax-s2">                    *   **Task Planning &amp; Sequencing (for Multi-Step Requests):**</span>
<span class="devsite-syntax-s2">                        *   Before delegating, outline the clear sequence of agent tasks.</span>
<span class="devsite-syntax-s2">                        *   Identify dependencies. If Task B requires output from Task A, execute them sequentially. If tasks are independent (like creating a post and then creating an event), execute them one after the other as separate delegations.</span>
<span class="devsite-syntax-s2">                        *   Agent Reusability: An agent's completion of one task does not make it unavailable. If a user's plan involves multiple, distinct actions that fall under the same agent's expertise (e.g., create a post, then create an event), you must call that same agent again for the subsequent task.</span>

<span class="devsite-syntax-s2">                    *   **Task Delegation &amp; Management (using `send_message`):**</span>
<span class="devsite-syntax-s2">                        *   **Delegation:** Use `send_message` to assign actionable tasks to the selected remote agent. Your `send_message` call MUST include:</span>
<span class="devsite-syntax-s2">                            *   The `remote_agent_name` you've selected.</span>
<span class="devsite-syntax-s2">                            *   The `user_request` or all necessary parameters extracted from the user's input, formatted in a way the target agent will understand.</span>
<span class="devsite-syntax-s2">                        *   **Contextual Awareness for Remote Agents:** If a remote agent repeatedly requests user confirmation or seems to lack context, assume it lacks access to the full conversation history. In such cases, enrich your `send_message` with all necessary contextual information relevant to that specific agent from the conversation history.</span>
<span class="devsite-syntax-s2">                        *   **Sequential Task Execution:**</span>
<span class="devsite-syntax-s2">                            *   After a preceding task completes (indicated by the agent's response or a success signal), gather any necessary output from it.</span>
<span class="devsite-syntax-s2">                            *   Then, use `send_message` for the next agent in the sequence, providing it with the user's original relevant intent and any necessary data obtained from the previous agent's task.</span>
<span class="devsite-syntax-s2">                        *   **Active Agent Prioritization:** If an active agent is already engaged and the user's request is related to its current task, route subsequent related requests directly to that agent by providing updated context via `send_message`.</span>
<span class="devsite-syntax-s2">                    </span>
<span class="devsite-syntax-s2">                    </span>
<span class="devsite-syntax-s2">                    **Critical Success Verification:**</span>

<span class="devsite-syntax-s2">                    *   You **MUST** wait for the tool_output after every send_message call before taking any further action.</span>
<span class="devsite-syntax-s2">                    *   Your decision to proceed to the next task in a sequence **MUST** be based entirely on a confirmation of success from the tool_output of the previous task.</span>
<span class="devsite-syntax-s2">                    *   If a tool call fails, returns an error, or the tool_output is ambiguous, you MUST STOP the sequence. Your next action is to report the exact failure or ambiguity to the user.</span>
<span class="devsite-syntax-s2">                    *   DO NOT assume a task was successful. Do not invent success messages like "The event has been created." Only state that a task is complete if the tool's response explicitly says so.</span>
<span class="devsite-syntax-s2">                    </span>
<span class="devsite-syntax-s2">                    **Communication with User:**</span>

<span class="devsite-syntax-s2">                    *   **Transparent Communication:** Always present the complete and detailed response from the remote agent to the user. Do not summarize or filter unless explicitly instructed.</span>
<span class="devsite-syntax-s2">                    *   When you delegate a task (or the first task in a sequence), clearly inform the user which remote agent is handling it.</span>
<span class="devsite-syntax-s2">                    *   For multi-step requests, you can optionally inform the user of the planned sequence (e.g., "Okay, first I'll ask the 'Social Profile Agent' to analyze the profile, and then I'll have the 'Instavibe Posting Agent' create the post.").</span>
<span class="devsite-syntax-s2">                    *   If waiting for a task in a sequence to complete, you can inform the user (e.g., "The 'Social Profile Agent' is currently processing. I'll proceed with the post once that's done.").</span>
<span class="devsite-syntax-s2">                    *   **User Confirmation Relay:** If a remote agent asks for confirmation, and the user has not already provided it, just make up something.</span>
<span class="devsite-syntax-s2">                    *   If the user's request is ambiguous, if necessary information is missing for any agent in the sequence, or if you are unsure about the plan, just make up something.</span>

<span class="devsite-syntax-s2">                    **Important Reminders:**</span>

<span class="devsite-syntax-s2">                    *   **Autonomous Agent Engagement:** Never seek user permission before engaging with remote agents. If multiple agents are required to fulfill a request, connect with them directly without requesting user preference or confirmation.</span>
<span class="devsite-syntax-s2">                    *   **Focused Information Sharing:** Provide remote agents with only relevant contextual information. Avoid extraneous details that are not directly pertinent to their task.</span>
<span class="devsite-syntax-s2">                    *   **No Redundant Confirmations:** Do not ask remote agents for confirmation of information or actions they have already processed or committed to.</span>
<span class="devsite-syntax-s2">                    *   **Tool Reliance:** Strictly rely on your available tools, primarily `send_message`, to address user requests. Do not generate responses based on assumptions. If information is insufficient, request clarification from the user.</span>
<span class="devsite-syntax-s2">                    *   **Prioritize Recent Interaction:** Focus primarily on the most recent parts of the conversation when processing requests, while maintaining awareness of the overall goal for multi-step tasks.</span>
<span class="devsite-syntax-s2">                    *   Always prioritize selecting the correct agent(s) based on their documented purpose.</span>
<span class="devsite-syntax-s2">                    *   Ensure all information required by the chosen remote agent is included in the `send_message` call, including outputs from previous agents if it's a sequential task.</span>

<span class="devsite-syntax-s2">                    Agents:</span>
<span class="devsite-syntax-s2">                    </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-si">}</span>

<span class="devsite-syntax-s2">                    Current agent: </span><span class="devsite-syntax-si">{</span><span class="devsite-syntax-n">current_agent</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-s1">'active_agent'</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-s2">`</span>
<span class="devsite-syntax-s2">                """</span>
</code></pre></devsite-code>
<h2 is-upgraded id="testing-the-orchestrator-and-the-full-a2a-system" data-text="Testing the Orchestrator and the Full A2A System" tabindex="-1">Testing the Orchestrator and the Full A2A System</h2>
<p>Now, let&#39;s test the entire system. We&#39;ll run the Orchestrator locally using the ADK Dev UI, and it will communicate with the Planner, Platform, and Social agents running remotely on Cloud Run.</p>
<p>üëâüíª First, ensure the environment variable <code translate="no" dir="ltr">REMOTE_AGENT_ADDRESSES</code> contains the comma-separated URLs of your deployed A2A-enabled agents. Then, set the necessary environment variables for the Orchestrator agent and launch the ADK Dev UI:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>

<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PLATFORM_MPC_CLIENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">client</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PLANNER_AGENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SOCIAL_AGENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">social</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">REMOTE_AGENT_ADDRESSES</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PLANNER_AGENT_URL</span><span class="devsite-syntax-p">},</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PLATFORM_MPC_CLIENT_URL</span><span class="devsite-syntax-p">},</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SOCIAL_AGENT_URL</span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-n">cd</span>  <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span>
<span class="devsite-syntax-n">sed</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">i</span> <span class="devsite-syntax-s2">"s|^\(O\?REMOTE_AGENT_ADDRESSES\)=.*|REMOTE_AGENT_ADDRESSES=$</span><span class="devsite-syntax-si">{REMOTE_AGENT_ADDRESSES}</span><span class="devsite-syntax-s2">|"</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">orchestrate</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">env</span>
<span class="devsite-syntax-n">adk</span> <span class="devsite-syntax-n">web</span>
</code></pre></devsite-code>
<p>üëâ Open the ADK Dev UI (Change the port back to <strong>8000</strong> via Web Preview).</p>
<p class="image-container"><img alt="10-08-web-preview.png" src="/static/instavibe-adk-multi-agents/img/10-08-web-preview.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-08-web-preview_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ In the agent dropdown, select the <strong>orchestrate</strong> agent.</p>
<p>üëâ Now, give it a complex task that requires coordinating multiple remote agents. Try this first example, which should involve the Social Agent and then the Planner Agent:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">You</span> <span class="devsite-syntax-n">are</span> <span class="devsite-syntax-n">an</span> <span class="devsite-syntax-n">expert</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-n">planner</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">user</span> <span class="devsite-syntax-n">named</span>  <span class="devsite-syntax-n">Diana</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-n">Your</span> <span class="devsite-syntax-n">task</span> <span class="devsite-syntax-ow">is</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">design</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">personalized</span> <span class="devsite-syntax-n">event</span><span class="devsite-syntax-o">.</span>

    <span class="devsite-syntax-n">Here</span> <span class="devsite-syntax-n">are</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">details</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">plan</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">Friends</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">invite</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">Ian</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">Nora</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">Desired</span> <span class="devsite-syntax-n">date</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"2025-10-15"</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">Location</span> <span class="devsite-syntax-n">idea</span> <span class="devsite-syntax-ow">or</span> <span class="devsite-syntax-n">general</span> <span class="devsite-syntax-n">preference</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Chicago"</span>

    <span class="devsite-syntax-n">Your</span> <span class="devsite-syntax-n">process</span> <span class="devsite-syntax-n">should</span> <span class="devsite-syntax-n">be</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-mf">1.</span> <span class="devsite-syntax-n">Analyze</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">provided</span> <span class="devsite-syntax-n">friend</span> <span class="devsite-syntax-n">names</span><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-n">If</span> <span class="devsite-syntax-n">you</span> <span class="devsite-syntax-n">have</span> <span class="devsite-syntax-n">access</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">tool</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">get</span> <span class="devsite-syntax-n">their</span> <span class="devsite-syntax-n">InstaVibe</span> <span class="devsite-syntax-n">profiles</span> <span class="devsite-syntax-ow">or</span> <span class="devsite-syntax-n">summarized</span> <span class="devsite-syntax-n">interests</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">please</span> <span class="devsite-syntax-n">use</span> <span class="devsite-syntax-n">it</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-mf">2.</span> <span class="devsite-syntax-n">Based</span> <span class="devsite-syntax-n">on</span> <span class="devsite-syntax-n">their</span> <span class="devsite-syntax-n">potential</span> <span class="devsite-syntax-n">interests</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-ow">or</span> <span class="devsite-syntax-n">general</span> <span class="devsite-syntax-n">good</span> <span class="devsite-syntax-n">taste</span> <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">profiles</span> <span class="devsite-syntax-n">are</span> <span class="devsite-syntax-n">unavailable</span><span class="devsite-syntax-p">),</span> <span class="devsite-syntax-n">create</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">tailored</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">outing</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">check</span> <span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">you</span> <span class="devsite-syntax-n">have</span> <span class="devsite-syntax-n">access</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-nb">any</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-n">planner</span> <span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-mf">3.</span> <span class="devsite-syntax-n">Ensure</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-n">includes</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">original</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">planned_date</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>

    <span class="devsite-syntax-n">The</span> <span class="devsite-syntax-n">user</span> <span class="devsite-syntax-n">wants</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">comprehensive</span> <span class="devsite-syntax-n">plan</span> <span class="devsite-syntax-n">that</span> <span class="devsite-syntax-n">includes</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">The</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">invited</span> <span class="devsite-syntax-n">friends</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-n">catchy</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">descriptive</span> <span class="devsite-syntax-n">name</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">event</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">The</span> <span class="devsite-syntax-n">exact</span> <span class="devsite-syntax-n">planned</span> <span class="devsite-syntax-n">date</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">event</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-n">summary</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">what</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">group</span> <span class="devsite-syntax-n">will</span> <span class="devsite-syntax-n">do</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">Specific</span> <span class="devsite-syntax-n">recommended</span> <span class="devsite-syntax-n">spots</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">g</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">restaurants</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">bars</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">activity</span> <span class="devsite-syntax-n">venues</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">their</span> <span class="devsite-syntax-n">names</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">if</span> <span class="devsite-syntax-n">possible</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">approximate</span> <span class="devsite-syntax-n">latitude</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">longitude</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">mapping</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">address</span><span class="devsite-syntax-p">),</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">brief</span> <span class="devsite-syntax-n">description</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">why</span> <span class="devsite-syntax-n">it</span> <span class="devsite-syntax-n">fits</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">plan</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-o">-</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-n">short</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">exciting</span> <span class="devsite-syntax-n">message</span> <span class="devsite-syntax-n">that</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">Diana</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-n">can</span> <span class="devsite-syntax-n">send</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">Ian</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">Nora</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">get</span> <span class="devsite-syntax-n">them</span> <span class="devsite-syntax-n">excited</span> <span class="devsite-syntax-n">about</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">event</span><span class="devsite-syntax-o">.</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="Orchestrate" src="/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-01-adk-orchestrate_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Observe the interaction in the ADK Dev UI chat window. Pay close attention to the Orchestrator&#39;s responses ‚Äì it should state which remote agent it&#39;s delegating tasks to (e.g., &#34;Okay, I&#39;ll ask the Social Profile Agent about Ian and Nora first...&#34;).</p>
<p>Also, check the Events tab in the UI to see the underlying tool calls (send_message) being made to the remote agents&#39; URLs.</p>
<p class="image-container"><img alt="Send Task" src="/static/instavibe-adk-multi-agents/img/11-02-send-task.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-02-send-task_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>üëâ Now, try a second example that should involve the Platform Integration Agent directly:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-text" class="language-text" translate="no" dir="ltr"><span class="devsite-syntax-n">Hey</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">can</span> <span class="devsite-syntax-n">you</span> <span class="devsite-syntax-n">register</span> <span class="devsite-syntax-n">an</span> <span class="devsite-syntax-n">event</span> <span class="devsite-syntax-n">on</span> <span class="devsite-syntax-n">Instavibe</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">Laura</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">Charlie</span><span class="devsite-syntax-err">?</span> <span class="devsite-syntax-n">Let</span><span class="devsite-syntax-s1">'s call it '</span><span class="devsite-syntax-n">Vienna</span> <span class="devsite-syntax-n">Concert</span> &amp; <span class="devsite-syntax-n">Castles</span> <span class="devsite-syntax-n">Day</span><span class="devsite-syntax-s1">'.</span>
<span class="devsite-syntax-n">here</span> <span class="devsite-syntax-n">are</span> <span class="devsite-syntax-n">more</span> <span class="devsite-syntax-n">info</span>
<span class="devsite-syntax-s2">"event_name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Vienna Concert &amp; Castles Day"</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"A refined and unforgettable day in Vienna with Laura and Charlie. The day begins with a guided tour of the magnificent Sch√∂nbrunn Palace, showcasing imperial architecture and history. In the evening, enjoy a classical music concert in one of Vienna's most iconic concert halls."</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-s2">"event_date"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"2025-10-14T10:00:00+02:00"</span><span class="devsite-syntax-p">,</span>
  <span class="devsite-syntax-s2">"locations"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-p">[</span>
    <span class="devsite-syntax-p">{</span>
      <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Sch√∂nbrunn Palace"</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"A UNESCO World Heritage Site and former imperial summer residence, Sch√∂nbrunn Palace offers opulent rooms, beautiful baroque gardens, and a glimpse into the life of the Habsburg monarchy. Visitors can stroll the grounds or take a guided historical tour."</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"latitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">48.184516</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"longitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">16.312222</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"address"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Sch√∂nbrunner Schlo√üstra√üe 47, 1130 Wien, Austria"</span>
    <span class="devsite-syntax-p">},</span>
    <span class="devsite-syntax-p">{</span>
      <span class="devsite-syntax-s2">"name"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Musikverein Vienna"</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"description"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Home to the world-renowned Vienna Philharmonic, the Musikverein is one of the finest concert halls in the world. Its 'Golden Hall' is famous for its acoustics and ornate design. Attendees can enjoy a powerful classical concert in an unforgettable setting."</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"latitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">48.200132</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"longitude"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-mf">16.373777</span><span class="devsite-syntax-p">,</span>
      <span class="devsite-syntax-s2">"address"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-s2">"Musikvereinsplatz 1, 1010 Wien, Austria"</span>
    <span class="devsite-syntax-p">}</span>
  <span class="devsite-syntax-p">],</span>
  <span class="devsite-syntax-s2">"attendee_names"</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-s2">"Laura"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"Charlie"</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s2">"Oscar"</span><span class="devsite-syntax-p">]</span> <span class="devsite-syntax-n">And</span> <span class="devsite-syntax-n">I</span> <span class="devsite-syntax-n">am</span> <span class="devsite-syntax-n">Oscar</span>
</code></pre></devsite-code>
<p>Again, monitor the chat and the Events tab. The Orchestrator should identify the need to create an event and delegate the task (with all the provided details) to the &#34;Platform Integration Agent&#34;. You can also click on <strong>Trace</strong> button to view traces to analyze query response times and executed operations. <img alt="Send Event" src="/static/instavibe-adk-multi-agents/img/11-04-send-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-04-send-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>You can then verify the event appears in the InstaVibe web application. <img alt="InstaVibe Event" src="/static/instavibe-adk-multi-agents/img/11-05-instavibe-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/11-05-instavibe-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>This demonstrates the successful implementation of a multi-agent system using ADK and the A2A protocol, where a central orchestrator delegates tasks to specialized, remote agents.</p>
<p>Remember to stop the ADK Dev UI (<code translate="no" dir="ltr">Ctrl+C</code> in the terminal) when you are finished testing.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Agent Engine and Remote Call from InstaVibe" duration="0" step="11">
          
          <h2 class="step-title" id="11" data-text="Agent Engine and Remote Call from InstaVibe" tabindex="-1">
              12. Agent Engine and Remote Call from InstaVibe
          </h2>
          <p>So far, we&#39;ve run our specialized agents on Cloud Run and tested the Orchestrator locally using the ADK Dev UI. For a production scenario, we need a robust, scalable, and managed environment to host our agents. This is where Google Vertex AI Agent Engine comes in.</p>
<p>Agent Engine is a fully managed service on Vertex AI designed specifically for deploying and scaling AI agents. It abstracts away infrastructure management, security, and operational overhead, allowing developers (especially those less familiar with complex cloud environments) to focus on the agent&#39;s logic and capabilities rather than managing servers. It provides a dedicated runtime optimized for agentic workloads.</p>
<p>We&#39;ll now deploy our Orchestrator agent to Agent Engine. (Note: The deployment mechanism shown below uses a custom script (agent_engine_app.py) provided in the workshop materials, as official direct ADK-to-Agent-Engine deployment tools might still be evolving. This script handles packaging and deploying the Orchestrator agent, configured with the necessary remote agent addresses.)</p>
<p>Execute the following command to deploy the Orchestrator agent to Agent Engine. Make sure the REMOTE_AGENT_ADDRESSES environment variable (containing the URLs of your Planner, Platform, and Social agents on Cloud Run) is still correctly set from the previous section.</p>
<p>üëâüíª We&#39;ll deploy the Orchestrate agent to Agent Engine (Note: this is my own implementation of the deployment, ADK has an CLI to help deploy,  I will update this after BYO-SA being implemented.)</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">add</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
    <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:service-$PROJECT_NUMBER@gcp-sa-aiplatform-re.iam.gserviceaccount.com"</span> \
    <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/viewer"</span>


<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PLATFORM_MPC_CLIENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">client</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">PLANNER_AGENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SOCIAL_AGENT_URL</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-nb">list</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">us</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">central1</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">format</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s1">'value(URL)'</span> <span class="devsite-syntax-o">|</span> <span class="devsite-syntax-n">grep</span> <span class="devsite-syntax-n">social</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">REMOTE_AGENT_ADDRESSES</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PLANNER_AGENT_URL</span><span class="devsite-syntax-p">},</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PLATFORM_MPC_CLIENT_URL</span><span class="devsite-syntax-p">},</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SOCIAL_AGENT_URL</span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-n">sed</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">i</span> <span class="devsite-syntax-s2">"s|^\(O\?REMOTE_AGENT_ADDRESSES\)=.*|REMOTE_AGENT_ADDRESSES=$</span><span class="devsite-syntax-si">{REMOTE_AGENT_ADDRESSES}</span><span class="devsite-syntax-s2">|"</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">agents</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">orchestrate</span><span class="devsite-syntax-o">/.</span><span class="devsite-syntax-n">env</span>

<span class="devsite-syntax-n">adk</span> <span class="devsite-syntax-n">deploy</span> <span class="devsite-syntax-n">agent_engine</span> \
<span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">display_name</span> <span class="devsite-syntax-s2">"orchestrate-agent"</span> \
<span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">GOOGLE_CLOUD_PROJECT</span> \
<span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">GOOGLE_CLOUD_LOCATION</span> \
<span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">staging_bucket</span> <span class="devsite-syntax-n">gs</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">GOOGLE_CLOUD_PROJECT</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">engine</span> \
<span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">trace_to_cloud</span> \
<span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">requirements_file</span> <span class="devsite-syntax-n">orchestrate</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">requirements</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span> \
<span class="devsite-syntax-n">orchestrate</span>
</code></pre></devsite-code>
<aside class="warning"><p> Wait for the script to complete the deployment process. This might take a few minutes.</p>
</aside>
<p>Now that the Orchestrator is hosted on the managed Agent Engine platform, our InstaVibe web application needs to communicate with it. Instead of interacting via ADK Dev UI, the web app will make remote calls to the Agent Engine endpoint.</p>
<p class="image-container"><img alt="10-agent-remote.png" src="/static/instavibe-adk-multi-agents/img/10-agent-remote.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/10-agent-remote_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>First, we need to modify the InstaVibe application code to initialize the Agent Engine client using the unique ID of our deployed Orchestrator agent. This ID is required to target the correct agent instance on the platform.</p>
<p>üëâüìù Open <code translate="no" dir="ltr">~/instavibe-bootstrap/instavibe/introvertally.py</code> and replace the <code translate="no" dir="ltr">#REPLACE ME initiate agent_engine</code> with the following code. This retrieves the Agent Engine ID from an environment variable (which we&#39;ll set shortly) and gets a client object:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">ORCHESTRATE_AGENT_ID</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">os</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">environ</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s1">'ORCHESTRATE_AGENT_ID'</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">agent_engine</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">agent_engines</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">ORCHESTRATE_AGENT_ID</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Our planned user flow in InstaVibe involves two interactions with the agent: first, generating the recommended plan, and second, asking the user to confirm before the agent actually posts the event to the platform.</p>
<p>Since the InstaVibe web application (running on Cloud Run) and the Orchestrator agent (running on Agent Engine) are now separate services, the web app needs to make remote calls to the Agent Engine endpoint to interact with the agent.</p>
<p>üëâüìù Let&#39;s update the code that makes the initial call to generate the plan recommendation. In the same <code translate="no" dir="ltr">introvertally.py</code> file, replace the <code translate="no" dir="ltr">#REPLACE ME Query remote agent get plan</code> with the following snippet, which uses the agent_engine client to send the user&#39;s request:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">agent_engine</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">stream_query</span><span class="devsite-syntax-p">(</span>
                <span class="devsite-syntax-n">user_id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">user_id</span><span class="devsite-syntax-p">,</span>
                <span class="devsite-syntax-n">message</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">prompt_message</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>üëâüìù Next, update the code that handles the user&#39;s confirmation (e.g., when the user clicks &#34;Confirm Plan&#34;). This sends a follow-up message to the same conversation on Agent Engine, instructing the Orchestrator to proceed with posting the event (which it will delegate to the Platform Integration agent). Replace <code translate="no" dir="ltr">#REPLACE ME Query remote agent for confirmation</code> for confirmation in <code translate="no" dir="ltr">introvertally.py</code> with:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-n">agent_engine</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">stream_query</span><span class="devsite-syntax-p">(</span>
            <span class="devsite-syntax-n">user_id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">agent_session_user_id</span><span class="devsite-syntax-p">,</span>
            <span class="devsite-syntax-n">message</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">prompt_message</span><span class="devsite-syntax-p">,</span>
        <span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>The web application&#39;s routes need access to these functions. Ensure the necessary functions from introvertally.py are imported in the Flask routes file.</p>
<p>üëâüìù In <code translate="no" dir="ltr">cd ~/instavibe-bootstrap/instavibe/ally_routes.py</code>, we&#39;ll first point to the instance replace  <code translate="no" dir="ltr"># REPLACE ME TO ADD IMPORT</code> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-python" class="language-python" translate="no" dir="ltr"><span class="devsite-syntax-kn">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">introvertally</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-n">call_agent_for_plan</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">post_plan_event</span>
</code></pre></devsite-code>
<p>üëâüìù Add the prototype feature to InstaVibe, in <code translate="no" dir="ltr">~/instavibe-bootstrap/instavibe/templates/base.html</code>, replace <strong>&lt;!‚ÄìREPLACE_ME_LINK_TO_INTROVERT_ALLY‚Äì&gt;</strong> with following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-html" class="language-html" translate="no" dir="ltr">            &lt;<span class="devsite-syntax-n">li</span> <span class="devsite-syntax-n">class</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"nav-item"</span>&gt;
              &lt;<span class="devsite-syntax-n">a</span> <span class="devsite-syntax-n">class</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"nav-link"</span> <span class="devsite-syntax-n">href</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"&#123;&#123; url_for('ally.introvert_ally_page') }}"</span>&gt;<span class="devsite-syntax-n">Introvert</span> <span class="devsite-syntax-n">Ally</span>&lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">a</span>&gt;
            &lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">li</span>&gt;
</code></pre></devsite-code>
<p>Before we can redeploy the InstaVibe app, we need the specific <code translate="no" dir="ltr">Resource ID</code> of the Orchestrator agent we deployed to Agent Engine.</p>
<p>Currently, retrieving this programmatically via <code translate="no" dir="ltr">gcloud</code> might be limited, so we&#39;ll use a helper Python script (<code translate="no" dir="ltr">temp-endpoint.py</code> provided in the workshop) to fetch the ID and store it in an environment variable.</p>
<aside class="warning"><p> To ensure proper functionality, verify that the <strong>sole</strong> agent deployed in the agent engine is the new ‚Äòorchestrate&#39; agent.</p>
</aside>
<p>üëâüíª Run the following commands to execute the script. The script will capture the <strong>Agent Engine Endpoint ID</strong> and grant the necessary permissions to the agent engine&#39;s default service account (Note: The script is configured to use the default service account as it is currently not user-modifiable).</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">python</span> <span class="devsite-syntax-n">temp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">endpoint</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">py</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">ORCHESTRATE_AGENT_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">cat</span> <span class="devsite-syntax-n">temp_endpoint</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"ORCHESTRATE_AGENT_ID set to: $</span><span class="devsite-syntax-si">{ORCHESTRATE_AGENT_ID}</span><span class="devsite-syntax-s2">"</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="Agent Engine Endpoint ID" src="/static/instavibe-adk-multi-agents/img/12-01-endpoint-url.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-01-endpoint-url_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Finally, we need to redeploy the InstaVibe web application with the updated code and the new <code translate="no" dir="ltr">ORCHESTRATE_AGENT_ID</code> environment variable so it knows how to connect to our agent running on Agent Engine.</p>
<p>üëâüíª The following commands rebuild the InstaVibe application image and deploy the new version to Cloud Run:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>

<span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span>

<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_TAG</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"latest"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">APP_FOLDER_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe-webapp"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">-docker.pkg.dev/$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">/$</span><span class="devsite-syntax-si">{IMAGE_NAME}</span><span class="devsite-syntax-s2">:$</span><span class="devsite-syntax-si">{IMAGE_TAG}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"instavibe"</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Building $</span><span class="devsite-syntax-si">{APP_FOLDER_NAME}</span><span class="devsite-syntax-s2"> webapp image..."</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">builds</span> <span class="devsite-syntax-n">submit</span> <span class="devsite-syntax-o">.</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">tag</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Deploying $</span><span class="devsite-syntax-si">{SERVICE_NAME}</span><span class="devsite-syntax-s2"> to Cloud Run..."</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">deploy</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SERVICE_NAME</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">image</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">IMAGE_PATH</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">allow</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">unauthenticated</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"SPANNER_INSTANCE_ID=$</span><span class="devsite-syntax-si">{SPANNER_INSTANCE_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"SPANNER_DATABASE_ID=$</span><span class="devsite-syntax-si">{SPANNER_DATABASE_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"APP_HOST=0.0.0.0"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"APP_PORT=8080"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_LOCATION=$</span><span class="devsite-syntax-si">{REGION}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_CLOUD_PROJECT=$</span><span class="devsite-syntax-si">{PROJECT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"GOOGLE_MAPS_API_KEY=$</span><span class="devsite-syntax-si">{GOOGLE_MAPS_API_KEY}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">set</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb">vars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"ORCHESTRATE_AGENT_ID=$</span><span class="devsite-syntax-si">{ORCHESTRATE_AGENT_ID}</span><span class="devsite-syntax-s2">"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-nb">min</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">instances</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">1</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">cpu</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">2</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">memory</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-n">Gi</span>
</code></pre></devsite-code>
<p>With the final deployment complete, navigate to your InstaVibe application URL in a different browser tab.</p>
<h2 is-upgraded id="testing-the-full-ai-powered-instavibe-experience" data-text="Testing the Full AI-Powered InstaVibe Experience" tabindex="-1">Testing the Full AI-Powered InstaVibe Experience</h2>
<p>The &#34;InstaVibe Ally&#34; feature is now live, powered by our multi-agent system orchestrated via Vertex AI Agent Engine and communicating through A2A.</p>
<p class="image-container"><img alt="12-02-new.png" src="/static/instavibe-adk-multi-agents/img/12-02-new.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-02-new_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Click into &#34;InstaVibe Ally&#34; and ask it to plan an event.</p>
<p class="image-container"><img alt="12-03-introvertally.png" src="/static/instavibe-adk-multi-agents/img/12-03-introvertally.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-03-introvertally_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Observe the activity log on the right while the agents work (it may take 90-120 seconds). Once the plan appears, review it and click &#34;Confirm This Plan&#34; to proceed with posting.</p>
<p class="image-container"><img alt="12-04-confirm.png" src="/static/instavibe-adk-multi-agents/img/12-04-confirm.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-04-confirm_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The orchestrator will now instruct the Platform agent to create the post and event within InstaVibe. <img alt="12-05-posting.png" src="/static/instavibe-adk-multi-agents/img/12-05-posting.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-05-posting_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Check the InstaVibe home page for the new post and event. <img alt="12-06-instavibe.png" src="/static/instavibe-adk-multi-agents/img/12-06-instavibe.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-06-instavibe_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The event page will reflect the details generated by the agent.</p>
<p class="image-container"><img alt="12-07-event.png" src="/static/instavibe-adk-multi-agents/img/12-07-event.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-07-event_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<h2 is-upgraded id="analyzing-performance-with-cloud-trace" data-text="Analyzing Performance with Cloud Trace" tabindex="-1">Analyzing Performance with Cloud Trace</h2>
<p>You might notice the process takes some time. Vertex AI Agent Engine integrates with Cloud Trace, allowing us to analyze the latency of our multi-agent system.</p>
<aside class="warning"><p> It takes about 5-6 minutes for the trace to be populated.</p>
</aside>
<p>Go to the <a href="https://console.cloud.google.com/traces" target="_blank">Traces</a> in the google cloud console, select <code translate="no" dir="ltr">agent_run[orchestrate_agent]</code> in the Span, you should see a couple of Spans, click into it</p>
<p class="image-container"><img alt="12-08-trace.png" src="/static/instavibe-adk-multi-agents/img/12-08-trace.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-08-trace_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Within the trace details, you can identify which parts took longer. For example, calls to the Planner agent might show higher latency due to search grounding and complex generation. <img alt="12-09-plan.png" src="/static/instavibe-adk-multi-agents/img/12-09-plan.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-09-plan_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Similarly, when creating the post and event, you might see time spent by the Orchestrator processing data and preparing tool calls for the Platform agent. <img alt="12-10-post.png" src="/static/instavibe-adk-multi-agents/img/12-10-post.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/12-10-post_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Exploring these traces helps understand and optimize the performance of your agent system.</p>
<p class="image-container"><img alt="celebrate.png" src="/static/instavibe-adk-multi-agents/img/celebrate.jpg" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_36.jpg 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_48.jpg 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_72.jpg 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_96.jpg 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_480.jpg 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_720.jpg 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_856.jpg 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_960.jpg 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_1440.jpg 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_1920.jpg 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/celebrate_2880.jpg 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Congratulations! You&#39;ve successfully built, deployed, and tested a sophisticated multi-agent AI system using Google&#39;s ADK, A2A, MCP, and Google Cloud services. You&#39;ve tackled agent orchestration, tool usage, state management, and cloud deployment, creating a functional AI-powered feature for InstaVibe. Well done on completing the workshop!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Clean Up" duration="0" step="12">
          
          <h2 class="step-title" id="12" data-text="Clean Up" tabindex="-1">
              13. Clean Up
          </h2>
          <p>To avoid ongoing charges to your Google Cloud account, it&#39;s important to delete the resources we created during this workshop. The following commands will help you remove the Spanner instance, Cloud Run services, Artifact Registry repository, API Key, Vertex AI Agent Engine, and associated IAM permissions.</p>
<p>Important:</p>
<ul>
<li>Ensure you are running these commands in the same Google Cloud project used for the workshop.</li>
<li>If you&#39;ve closed your Cloud Shell terminal, some environment variables like $PROJECT_ID, $SPANNER_INSTANCE_ID, etc., might not be set. You&#39;ll need to either re-export them as you did during the workshop setup or replace the variables in the commands below with their actual values.</li>
<li>These commands will permanently delete your resources. Double-check before running if you have other important data in this project.</li>
</ul>
<p>üëâüíª Run the following scripts to clean up.</p>
<h2 is-upgraded id="reset-environment-variables" data-text="Reset environment variables" tabindex="-1">Reset environment variables</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">set_env</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sh</span>
</code></pre></devsite-code>
<h2 is-upgraded id="delete-agent-engine:" data-text="Delete Agent Engine:" tabindex="-1">Delete Agent Engine:</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">cd</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">utils</span>
<span class="devsite-syntax-n">source</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">env</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-nb">bin</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">activate</span>
<span class="devsite-syntax-n">export</span> <span class="devsite-syntax-n">ORCHESTRATE_AGENT_ID</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">cat</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">temp_endpoint</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"ORCHESTRATE_AGENT_ID set to: $</span><span class="devsite-syntax-si">{ORCHESTRATE_AGENT_ID}</span><span class="devsite-syntax-s2">"</span>
<span class="devsite-syntax-n">python</span> <span class="devsite-syntax-n">remote_delete</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">py</span>
<span class="devsite-syntax-n">deactivate</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Vertex AI Agent Engine deletion initiated."</span>
</code></pre></devsite-code>
<h2 is-upgraded id="delete-cloud-run-services:" data-text="Delete Cloud Run Services:" tabindex="-1">Delete Cloud Run Services:</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-c1"># InstaVibe Web Application</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-n">instavibe</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>

<span class="devsite-syntax-c1"># MCP Tool Server</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">tool</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">server</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>

<span class="devsite-syntax-c1"># Planner Agent (A2A Server)</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-n">planner</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>

<span class="devsite-syntax-c1"># Platform MCP Client Agent (A2A Server)</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">mcp</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">client</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>

<span class="devsite-syntax-c1"># Social Agent (A2A Server)</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">run</span> <span class="devsite-syntax-n">services</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-n">social</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">agent</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">platform</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">managed</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">region</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>

<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Cloud Run services deletion initiated."</span>
</code></pre></devsite-code>
<h2 is-upgraded id="stop-and-remove-the-a2a-inspector-docker-container" data-text="Stop and Remove the A2A Inspector Docker Container" tabindex="-1">Stop and Remove the A2A Inspector Docker Container</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">docker</span> <span class="devsite-syntax-n">rm</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">force</span> <span class="devsite-syntax-n">a2a</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">inspector</span>
</code></pre></devsite-code>
<h2 is-upgraded id="delete-spanner-instance:" data-text="Delete Spanner Instance:" tabindex="-1">Delete Spanner Instance:</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Deleting Spanner instance: $</span><span class="devsite-syntax-si">{SPANNER_INSTANCE_ID}</span><span class="devsite-syntax-s2">..."</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">spanner</span> <span class="devsite-syntax-n">instances</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">SPANNER_INSTANCE_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Spanner instance deletion initiated."</span>
</code></pre></devsite-code>
<h2 is-upgraded id="delete-artifact-registry-repository:" data-text="Delete Artifact Registry Repository:" tabindex="-1">Delete Artifact Registry Repository:</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Deleting Artifact Registry repository: $</span><span class="devsite-syntax-si">{REPO_NAME}</span><span class="devsite-syntax-s2">..."</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">artifacts</span> <span class="devsite-syntax-n">repositories</span> <span class="devsite-syntax-n">delete</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REPO_NAME</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">location</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">REGION</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">project</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-err">$</span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">PROJECT_ID</span><span class="devsite-syntax-p">}</span> <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">quiet</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Artifact Registry repository deletion initiated."</span>
</code></pre></devsite-code>
<h2 is-upgraded id="remove-roles-from-service-account:" data-text="Remove Roles from Service Account:" tabindex="-1">Remove Roles from Service Account:</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Removing roles from service account: $SERVICE_ACCOUNT_NAME in project $PROJECT_ID"</span>

<span class="devsite-syntax-c1"># Remove Project-level roles for default service account</span>
<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/spanner.admin"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/spanner.databaseUser"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/artifactregistry.admin"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/cloudbuild.builds.editor"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/run.admin"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/iam.serviceAccountUser"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/aiplatform.user"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/logging.logWriter"</span>

<span class="devsite-syntax-n">gcloud</span> <span class="devsite-syntax-n">projects</span> <span class="devsite-syntax-n">remove</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">iam</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">policy</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">binding</span> <span class="devsite-syntax-err">$</span><span class="devsite-syntax-n">PROJECT_ID</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">member</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"serviceAccount:$SERVICE_ACCOUNT_NAME"</span> \
  <span class="devsite-syntax-o">--</span><span class="devsite-syntax-n">role</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"roles/logging.viewer"</span>


<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"All specified roles have been removed."</span>
</code></pre></devsite-code>
<h2 is-upgraded id="delete-local-workshop-files:" data-text="Delete Local Workshop Files:" tabindex="-1">Delete Local Workshop Files:</h2>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code language="language-bash" class="language-bash" translate="no" dir="ltr"><span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Removing local workshop directory ~/instavibe-bootstrap..."</span>
<span class="devsite-syntax-n">rm</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">rf</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">instavibe</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">bootstrap</span>
<span class="devsite-syntax-n">rm</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">rf</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">a2a</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">inspector</span>
<span class="devsite-syntax-n">rm</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">f</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">mapkey</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span>
<span class="devsite-syntax-n">rm</span> <span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">f</span> <span class="devsite-syntax-o">~/</span><span class="devsite-syntax-n">project_id</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">txt</span>
<span class="devsite-syntax-n">echo</span> <span class="devsite-syntax-s2">"Local directory removed."</span>
</code></pre></devsite-code>
<p class="image-container"><img alt="Clean Up" src="/static/instavibe-adk-multi-agents/img/13-01-clean.png" srcset="https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_36.png 36w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_48.png 48w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_72.png 72w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_96.png 96w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_480.png 480w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_720.png 720w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_856.png 856w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_960.png 960w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_1440.png 1440w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_1920.png 1920w,https://codelabs.developers.google.com/static/instavibe-adk-multi-agents/img/13-01-clean_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>


        </google-codelab-step>
      
    </google-codelab>
  
  

  
</div>

  
    
    
    
  

  <div class="devsite-floating-action-buttons"></div></article>


<devsite-content-footer class="nocontent">
  <p>Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/site-policies">Google Developers Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  
</devsite-content-footer>


<devsite-notification
>
</devsite-notification>


  
<div class="devsite-content-data">
  
  
    <template class="devsite-content-data-template">
      [[["Easy to understand","easyToUnderstand","thumb-up"],["Solved my problem","solvedMyProblem","thumb-up"],["Other","otherUp","thumb-up"]],[["Missing the information I need","missingTheInformationINeed","thumb-down"],["Too complicated / too many steps","tooComplicatedTooManySteps","thumb-down"],["Out of date","outOfDate","thumb-down"],["Samples / code issue","samplesCodeIssue","thumb-down"],["Other","otherDown","thumb-down"]],[],[],[],null,[]]
    </template>
  
</div>
            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            
          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Connect</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//googledevelopers.blogspot.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Blog
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.facebook.com/Google-Developers-967415219957038"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Facebook
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//medium.com/google-developers"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Medium
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//twitter.com/googledevs"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Twitter
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.youtube.com/user/GoogleDevelopers"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            YouTube
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Programs</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.womentechmakers.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Women Techmakers
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//developers.google.com/community/gdg"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Google Developer Groups
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//developers.google.com/community/experts"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Google Developer Experts
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//developers.google.com/community/accelerators"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
              
              
            
          
            Accelerators
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Developer consoles</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//console.developers.google.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Google API Console
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//console.cloud.google.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Google Cloud Platform Console
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//play.google.com/apps/publish"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Google Play Console
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//console.firebase.google.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Firebase Console
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//console.actions.google.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            Actions on Google Console
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//cast.google.com/publish"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
          
            Cast SDK Developer Console
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//chrome.google.com/webstore/developer/dashboard"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 7)"
            >
            
              
              
            
          
            Chrome Web Store Dashboard
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  
  
  <nav class="devsite-footer-sites" aria-label="Other Google Developers websites">
    <a href="https://developers.google.com/"
       class="devsite-footer-sites-logo-link gc-analytics-event"
       data-category="Site-Wide Custom Events"
       data-label="Footer Google Developers Link">
      <picture>
        
        <img class="devsite-footer-sites-logo"
             src="https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/lockup-google-for-developers.svg"
             loading="lazy"
             alt="Google Developers">
      </picture>
    </a>
    <ul class="devsite-footer-sites-list">
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.android.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Android Link"
         
         >
          Android
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.chrome.com/home"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Chrome Link"
         
         >
          Chrome
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//firebase.google.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Firebase Link"
         
         >
          Firebase
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//cloud.google.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Google Cloud Platform Link"
         
         >
          Google Cloud Platform
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developers.google.com/products"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer All products Link"
         
         >
          All products
        </a>
      </li>
      
    </ul>
  </nav>
  

  
  <nav class="devsite-footer-utility-links" aria-label="Utility links">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//developers.google.com/terms/site-terms"
           data-category="Site-Wide Custom Events"
           data-label="Footer Terms link"
         >
          Terms
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//policies.google.com/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link"
         >
          Privacy
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 glue-cookie-notification-bar-control">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="#"
           data-category="Site-Wide Custom Events"
           data-label="Footer Manage cookies link"
         
           aria-hidden="true"
         >
          Manage cookies
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">Sign up for the Google Developers newsletter</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//services.google.com/fb/forms/googledevelopersnewsletter/?utm_medium=referral&amp;utm_source=google-products&amp;utm_team=googledevs&amp;utm_campaign=201611-newsletter-launch"
           data-category="Site-Wide Custom Events"
           data-label="Footer Subscribe link"
         >
          Subscribe
        </a>
        
      </li>
      
    </ul>
    
    
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="de"
        >Deutsch</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es"
        >Espa√±ol</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Espa√±ol ‚Äì Am√©rica Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Fran√ßais</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="it"
        >Italiano</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Portugu√™s ‚Äì Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Ti√™ÃÅng Vi√™Ã£t</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="tr"
        >T√ºrk√ße</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ru"
        >–†—É—Å—Å–∫–∏–π</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="he"
        >◊¢◊ë◊®◊ô◊™</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ar"
        >ÿßŸÑÿπÿ±ÿ®ŸäŸëÿ©</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fa"
        >ŸÅÿßÿ±ÿ≥€å</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="hi"
        >‡§π‡§ø‡§Ç‡§¶‡•Ä</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="bn"
        >‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="th"
        >‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >‰∏≠Êñá ‚Äì ÁÆÄ‰Ωì</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_tw"
        >‰∏≠Êñá ‚Äì ÁπÅÈ´î</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >Êó•Êú¨Ë™û</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >ÌïúÍµ≠Ïñ¥</a>
    </li>
    
  </ul>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel>
          
        </devsite-panel>
        
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar></devsite-snackbar>
    <devsite-tooltip ></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics>
      
        <script type="application/json" analytics>[]</script>
<script type="application/json" tag-management>{&#34;at&#34;: &#34;True&#34;, &#34;ga4&#34;: [], &#34;ga4p&#34;: [], &#34;gtm&#34;: [], &#34;parameters&#34;: {&#34;internalUser&#34;: &#34;False&#34;, &#34;language&#34;: {&#34;machineTranslated&#34;: &#34;False&#34;, &#34;requested&#34;: &#34;en&#34;, &#34;served&#34;: &#34;en&#34;}, &#34;pageType&#34;: &#34;codelab&#34;, &#34;projectName&#34;: null, &#34;signedIn&#34;: &#34;False&#34;, &#34;tenant&#34;: &#34;codelabs&#34;, &#34;recommendations&#34;: {&#34;sourcePage&#34;: &#34;&#34;, &#34;sourceType&#34;: 0, &#34;sourceRank&#34;: 0, &#34;sourceIdenticalDescriptions&#34;: 0, &#34;sourceTitleWords&#34;: 0, &#34;sourceDescriptionWords&#34;: 0, &#34;experiment&#34;: &#34;&#34;}, &#34;experiment&#34;: {&#34;ids&#34;: &#34;&#34;}}}</script>
      
    </devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
    
    
<script nonce="cV5PVLpNxkj8gytJHMX+NV4dE+42Re">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/js/app_loader.js', '[17,"en",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70","https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs","https://codelabs-dot-devsite-v2-prod.appspot.com",null,null,["/_pwa/codelabs/manifest.json","https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/favicon.png","https://www.gstatic.com/devrel-devsite/prod/v1cad304eab6ed28f3b327880a58163a09173752cefc8a71a602c8a68a1fc9d70/codelabs/images/lockup.svg","https://fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,21,25,50,52,63,70,75,76,80,87,91,92,93,97,98,100,101,102,103,104,105,107,108,109,110,112,113,117,118,120,122,124,125,126,127,129,130,131,132,133,134,135,136,138,140,141,147,148,149,151,152,156,157,158,159,161,163,164,168,169,170,179,180,182,183,186,191,193,196],"AIzaSyAP-jjEJBzmIyKR4F-3XITp8yM9T1gEEI8","AIzaSyB6xiKGDR5O3Ak2okS4rLkauxGUG7XP0hg","codelabs.developers.google.com","AIzaSyAQk0fBONSGUqCNznf6Krs82Ap1-NV6J4o","AIzaSyCCxcqdrZ_7QMeLCRY20bh_SXdAYqy70KY",null,null,null,["Search__enable_page_map","DevPro__enable_devpro_offers","Cloud__enable_cloudx_experiment_ids","Profiles__enable_completecodelab_endpoint","Cloud__enable_cloud_dlp_service","MiscFeatureFlags__enable_framebox_badge_methods","DevPro__enable_google_payments","Concierge__enable_pushui","DevPro__enable_google_one_card","MiscFeatureFlags__emergency_css","Profiles__enable_completequiz_endpoint","DevPro__enable_developer_subscriptions","Concierge__enable_remove_info_panel_tags","MiscFeatureFlags__enable_variable_operator_index_yaml","Profiles__enable_complete_playlist_endpoint","MiscFeatureFlags__developers_footer_image","Profiles__enable_dashboard_curated_recommendations","MiscFeatureFlags__developers_footer_dark_image","Search__enable_dynamic_content_confidential_banner","Profiles__enable_purchase_prompts","Profiles__enable_user_type","Profiles__require_profile_eligibility_for_signin","Profiles__enable_developer_profiles_callout","DevPro__enable_free_benefits","MiscFeatureFlags__enable_project_variables","Profiles__enable_callout_notifications","Cloud__cache_serialized_dynamic_content","Concierge__enable_actions_menu","DevPro__enable_google_payments_buyflow","MiscFeatureFlags__enable_appearance_cookies","Profiles__enable_recognition_badges","DevPro__enable_enterprise","Cloud__enable_cloud_shell","MiscFeatureFlags__enable_variable_operator","Experiments__reqs_query_experiments","Profiles__enable_awarding_url","CloudShell__cloud_code_overflow_menu","DevPro__enable_vertex_credit_card","DevPro__enable_code_assist","Search__enable_ai_search_summaries_for_all","MiscFeatureFlags__enable_explicit_template_dependencies","Search__enable_suggestions_from_borg","Profiles__enable_stripe_subscription_management","BookNav__enable_tenant_cache_key","DevPro__enable_firebase_workspaces_card","MiscFeatureFlags__enable_firebase_utm","Analytics__enable_clearcut_logging","DevPro__enable_embed_profile_creation","EngEduTelemetry__enable_engedu_telemetry","TpcFeatures__enable_unmirrored_page_left_nav","Cloud__enable_cloud_shell_fte_user_flow","DevPro__enable_cloud_innovators_plus","MiscFeatureFlags__enable_explain_this_code","DevPro__remove_eu_tax_intake_form","Profiles__enable_join_program_group_endpoint","Profiles__enable_release_notes_notifications","Profiles__enable_developer_profile_benefits_ui_redesign","Profiles__enable_page_saving","MiscFeatureFlags__enable_view_transitions","MiscFeatureFlags__gdp_dashboard_reskin_enabled","MiscFeatureFlags__enable_project_body_class","Profiles__enable_playlist_community_acl","Profiles__enable_public_developer_profiles","TpcFeatures__proxy_prod_host","Cloud__enable_free_trial_server_call","CloudShell__cloud_shell_button","DevPro__enable_nvidia_credits_card","Profiles__enable_profile_collections","Cloud__enable_llm_concierge_chat","Search__enable_ai_eligibility_checks","Cloud__enable_legacy_calculator_redirect","Cloud__fast_free_trial"],null,null,"AIzaSyBLEMok-5suZ67qRPzx0qUtbnLmyT_kCVE","https://developerscontentserving-pa.clients6.google.com","AIzaSyCM4QpTRSqP5qI4Dvjt4OAScIN8sOUlO-k","https://developerscontentsearch-pa.clients6.google.com",1,4,null,"https://developerprofiles-pa.clients6.google.com",[17,"codelabs","Google Codelabs","codelabs.developers.google.com",null,"codelabs-dot-devsite-v2-prod.appspot.com",null,null,[null,1,null,null,null,null,null,null,null,null,null,[1],null,null,null,null,null,null,[1],null,null,null,null,[1]],null,[33,null,null,null,null,null,"/images/lockup.svg",null,null,null,null,1,1,null,null,null,null,null,null,null,null,1,null,null,null,null,[]],[],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[6,1,14,15,20,22,23,29,32,36],null,[[],[1,1]],[[null,null,null,null,null,null,null,null,null,null,null,null,1]],null,4],null,"pk_live_5170syrHvgGVmSx9sBrnWtA5luvk9BwnVcvIi7HizpwauFG96WedXsuXh790rtij9AmGllqPtMLfhe2RSwD6Pn38V00uBCydV4m",1,1,"https://developerscontentinsights-pa.clients6.google.com","AIzaSyCg-ZUslalsEbXMfIo9ZP8qufZgo3LSBDU","AIzaSyDxT0vkxnY_KeINtA4LSePJO-4MAZPMRsE","https://developers.clients6.google.com",null,null,"AIzaSyBQom12tzI-rybN7Sf-KfeL4nwm-Rf7PmI\n",null,"https://developerslogging.clients6.google.com"]')
  
</script>

    <devsite-a11y-announce></devsite-a11y-announce>
  </body>
</html>